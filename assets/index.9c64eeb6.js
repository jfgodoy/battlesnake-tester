import{t as b,s as X,c as U,i as g,a,b as Pt,d as C,h as lt,e as it,f as De,g as Oe,S as de,j as ge,k as be,l as K,M as Z,m as we,n as he,o as k,p as Ht,q as Ie,r as ve,u as fe,v as ke,F as ye,w as jt,x as Ft,P as Yt,z as Gt,y as at,A as ct,B as Te,C as Ut,D as Jt,E as Vt,G as qt,I as Xt,H as se,J as Wt,K as Kt,L as Zt}from"./vendor.420f2ab7.js";const Qt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerpolicy&&(r.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?r.credentials="include":o.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}};Qt();const en=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></g></svg>');var dt=(e={})=>{const t=en.cloneNode(!0);return X(t,e,!0),t};function Ce(e,t){const n=t();U(()=>e.value=n.get()),e.addEventListener(n.updateOn,s=>n.set(s.target.value))}const ut=(e,t)=>({get:e,set:t,updateOn:"input"}),gt=(e,t)=>({get:e,set:t,updateOn:"blur"});function tn(e){let t=e.value;e.addEventListener("input",()=>{t.length>e.value.length&&(e.style.width="0"),e.style.width=`${e.scrollWidth}px`,t=e.value})}function nn(e,t,n){const s=n.split(".");return[()=>{let l=e;for(let i=0;i<s.length;i++)if(l=l[s[i]],l==null){if(i!==s.length-1)return;break}return l},l=>t.call(null,...s,l)]}const rn=b("<svg><g><image></image></g></svg>",6,!0),sn=b('<svg><filter><feColorMatrix color-interpolation-filters="sRGB" type="matrix" result="colormatrix"></feColorMatrix></filter></svg>',6,!0),Pe={head:{},tail:{}},on=e=>e.replace(/^bwc-/,"").replace(/^shac-/,"");async function Re(e,t){if(t=on(t),Pe[e][t])return Pe[e][t];const n=await fetch(`assets/${e}s/${t}.png`).then(s=>s.ok?s.blob():fetch(`assets/${e}s/default.png`).then(o=>o.blob())).then(s=>{const o=URL.createObjectURL(s);return r=>(()=>{const l=rn.cloneNode(!0),i=l.firstChild;return g(l,a(ln,{get color(){return r.fill}}),i),Pt(i,"http://www.w3.org/1999/xlink","xlink:href",o),X(i,r,!0,!1),U(()=>C(i,"filter",`url(#${ht(r.fill)}`)),l})()});return Pe[e][t]=n,n}function ht(e){const t=lt(e);return"color"+t.red.toString(16).padStart(2,"0")+t.green.toString(16).padStart(2,"0")+t.blue.toString(16).padStart(2,"0")}function ln(e){const t=lt(e.color),n=ht(e.color);return(()=>{const s=sn.cloneNode(!0),o=s.firstChild;return C(s,"id",n),U(()=>C(o,"values",`0 0 0 0 ${t.red/255}
                 0 0 0 0 ${t.green/255}
                 0 0 0 0 ${t.blue/255}
                 0 0 0 1 0`)),s})()}const an="_snake_pfrd6_1",cn="_head_pfrd6_6",dn="_body_pfrd6_12",un="_tail_pfrd6_18";var Le={snake:an,head:cn,body:dn,tail:un};const gn=b('<div><span><svg viewBox="0 0 100 100" width="20" height="20"></svg></span><span></span><span><svg viewBox="0 0 100 100" width="20" height="20"></svg></span></div>'),ze=e=>{const[t,n]=it(e,["color","head","tail"]),s=async()=>{const r=await Re("head",e.head),l=await Re("tail",e.tail);return{Head:r,Tail:l}},[o]=De(s);return a(de,{get when(){return o()},children:({Head:r,Tail:l})=>(()=>{const i=gn.cloneNode(!0),c=i.firstChild,v=c.firstChild,_=c.nextSibling,d=_.nextSibling,h=d.firstChild;return X(i,n,!1,!0),g(v,a(l,{get fill(){return e.color}})),g(h,a(r,{get fill(){return e.color}})),U(u=>{const w={flex:!0,[Le.snake]:!0},z=Le.tail,T=Le.body,O=e.color,W=Le.head;return u._v$=Oe(i,w,u._v$),z!==u._v$2&&(c.className=u._v$2=z),T!==u._v$3&&(_.className=u._v$3=T),O!==u._v$4&&_.style.setProperty("background-color",u._v$4=O),W!==u._v$5&&(d.className=u._v$5=W),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),i})()})},hn=b("<span>loading...</span>"),fn=b('<div class="fixed inset-0 h-full w-full z-10"></div>'),vn=b('<div class="absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-md z-20 border border-gray-100"><button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-100">Export/Import DB</button></div>'),mn=b('<div class="flex items-center"><div style="min-width:308px"><span class="font-bold text-gray-500">Server:</span><input class="ml-1 px-3 rounded bg-gray-100 text-gray-700 round min-w-44 w-0"></div><button class="bg-blue-400 text-white ml-8 px-2 font-bold rounded">New test</button><button class="bg-blue-400 text-white ml-8 px-2 font-bold rounded">Board builder</button><div class="flex-1 flex justify-end"><div class="relative"><button class="relative block rounded-md bg-white p-2 ml-1 border border-white hover:border-gray-200 focus:outline-none"></button></div></div></div>'),pn=b('<span class="text-red-400 font-bold">Error: </span>'),bn=b('<button class="border border-gray-400 rounded text-xs px-2 ml-3 text-gray-600">retry</button>'),wn=async e=>fetch(e).then(t=>t.json()).catch(t=>{const n=t;return fetch(e,{mode:"no-cors"}).then(s=>{throw new Error("your server hasn't enabled CORS")},s=>{throw n})});function yn(e){const[t,n]=e.server,[s,o]=e.style,r=async h=>{const u=await wn(h);k(u,k.object.partialShape({color:k.string,head:k.string,tail:k.string}));const{color:w,head:z,tail:T}=u;return{color:w,headType:z,tailType:T}},[l,{refetch:i}]=De(t,r);be(()=>o(l.loading||l.error?void 0:l()));const c=async()=>{await e.createEmptyTest(),e.setView("builder")},[v,_]=K(!1),d=(h,...u)=>()=>{_(!1),h(...u)};return(()=>{const h=mn.cloneNode(!0),u=h.firstChild,w=u.firstChild,z=w.nextSibling,T=u.nextSibling,O=T.nextSibling,W=O.nextSibling,A=W.firstChild,ee=A.firstChild;return Ce(z,()=>gt(t,n)),tn(z),g(u,a(we,{get children(){return[a(Z,{get when(){return l.loading},get children(){return hn.cloneNode(!0)}}),a(Z,{get when(){return l.error},children:j=>[(()=>{const Y=pn.cloneNode(!0);return Y.firstChild,g(Y,()=>j.message,null),Y})(),(()=>{const Y=bn.cloneNode(!0);return Y.$$click=()=>i(),Y})()]}),a(Z,{get when(){return s()},children:j=>a(ze,{class:"mx-2",get color(){return j.color},get head(){return j.headType},get tail(){return j.tailType}})})]}}),null),T.$$click=()=>e.setView("importer"),O.$$click=c,ee.$$click=()=>_(!v()),g(ee,a(dt,{class:"text-gray-500"})),g(A,a(de,{get when(){return v()},get children(){return[(()=>{const j=fn.cloneNode(!0);return j.$$click=()=>_(!1),j})(),(()=>{const j=vn.cloneNode(!0),Y=j.firstChild;return he(Y,"click",d(e.setView,"exportimportdb"),!0),j})()]}}),null),h})()}ge(["click"]);function xn(e){return Sn(e),{turn:e.Turn,snakes:e.Snakes.map($n),food:e.Food.map(He),hazards:e.Hazards.map(He)}}function $n(e){return{id:e.ID,name:e.Name,body:e.Body.map(He),color:e.Color,health:e.Health,latency:e.Latency,death:_n(e.Death),headType:e.HeadType&&e.HeadType.toLowerCase()||"default",tailType:e.TailType&&e.TailType.toLowerCase()||"default",squad:e.Squad,author:e.Author,shout:e.Shout,url:e.URL}}function _n(e){if(e)return{cause:e.Cause,turn:e.Turn||0,eliminatedBy:e.EliminatedBy}}function He(e){return{x:e.X,y:e.Y}}function Sn(e){e.Turn=e.Turn||0;for(const t of e.Snakes)for(const n of t.Body)n.X=n.X||0,n.Y=n.Y||0;for(const t of e.Food)t.X=t.X||0,t.Y=t.Y||0}const kn="v.1.2.3";async function Tn(e){const t=await fetch(e);return t.status===200?Promise.resolve(t.json()):Promise.resolve(t.json()).then(n=>(console.error(n.error),Promise.reject(n.error)))}async function Cn(e){const t=`https://engine.battlesnake.com/games/${e}`,n=await Tn(t),s={id:n.Game.ID,ruleset:{name:n.Game.Ruleset.name,version:kn},width:n.Game.Width,height:n.Game.Height,timeout:n.Game.SnakeTimeout},o=`wss://engine.battlesnake.com/socket/${e}`,r=await Rn(o,xn);return{game:s,frames:r}}function Rn(e,t){const n=new Map;return new Promise((s,o)=>{const r=new WebSocket(e);r.addEventListener("message",({data:l})=>{try{const i=JSON.parse(l),c=t(i);n.set(c.turn.toString(),c)}catch(i){o(i)}}),r.addEventListener("close",function(){const i=Ht((_,d)=>_.turn-d.turn,[...n.values()]),c=i.length-1;i[c].turn!==c?o(new Error("missing some frames")):s(i)})})}const Ln=k.object.exactShape({id:k.string,ruleset:{name:k.string,version:k.string},timeout:k.number,width:k.number,height:k.number}),je=k.object.exactShape({x:k.number,y:k.number}),zn=k.object.exactShape({cause:k.string,turn:k.number,eliminatedBy:k.string}),Nn=k.object.exactShape({id:k.string,name:k.string,url:k.string,body:k.array.ofType(je),health:k.number,death:k.any(zn,k.undefined),color:k.string,headType:k.string,tailType:k.string,latency:k.string,shout:k.string,squad:k.string,author:k.string}),Mn=k.object.exactShape({turn:k.number,snakes:k.array.ofType(Nn),food:k.array.ofType(je),hazards:k.array.ofType(je)}),An=k.string.oneOf(["Up","Down","Left","Right"]),ft=k.object.exactShape({id:k.string,description:k.string,timestamp:k.number,game:Ln,frames:k.array.ofType(Mn),frameToTest:k.number,snakeToTest:k.number,expectedResult:k.array.ofType(An)}),Bn=b('<div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">Create test from game</h3><div class="flex my-4"><div class="space-y-2"><div><span>Game ID or URL:</span><input class="py-0 rounded border-gray-400 mx-2 w-84 inline-block" type="text"><p></p></div></div></div></div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">Import from Json</h3><div class="flex my-4"><div class="space-y-2"><div><p> If you have a previouly exported test as Json, you can import it pasting the source here:</p><textarea class="rounded border-gray-400 mt-2 w-full inline-block"></textarea><p class="text-red-500"></p></div></div></div></div></div>'),vt=/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/;function En(e){const[t,n]=K(""),[s,o]=K(""),r=async()=>{o("importing...");const h=await Cn(t()).catch(w=>{throw o(w),w}),u={id:ve(10),description:`test for ${h.game.id}`,timestamp:Date.now(),game:h.game,frames:h.frames,frameToTest:0,snakeToTest:0,expectedResult:[]};await e.saveTest(u),e.setView("test")},l=h=>{const u=vt.exec(h);return u?u[0]:h};be(()=>{vt.exec(t())&&r()});let i;Ie(()=>i?.focus());const[c,v]=K(""),[_,d]=K();return be(async()=>{d();const h=c();if(h)try{const u=JSON.parse(h);k(u,ft);const w=u;w.id=ve(10),w.timestamp=Date.now(),await e.saveTest(w),e.setView("test")}catch(u){d(u.message)}}),(()=>{const h=Bn.cloneNode(!0),u=h.firstChild,w=u.firstChild,z=w.nextSibling,T=z.firstChild,O=T.firstChild,W=O.firstChild,A=W.nextSibling,ee=A.nextSibling,j=u.nextSibling,Y=j.firstChild,y=Y.nextSibling,m=y.firstChild,S=m.firstChild,I=S.firstChild,N=I.nextSibling,P=N.nextSibling;Ce(A,()=>ut(t,$=>n(l($))));const J=i;return typeof J=="function"?J(A):i=A,g(ee,s),Ce(N,()=>ut(c,v)),g(P,_),h})()}const Dn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641l2.5-8.5zM6.374 1L4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04L11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1H6.374z"/></g></svg>');var On=(e={})=>{const t=Dn.cloneNode(!0);return X(t,e,!0),t};const In=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 21a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zm-3.25-1.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0zm-3-12.75a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zM2.5 4.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0zM18.25 6.5a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zM15 4.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0z" fill="currentColor"/><path fill-rule="evenodd" d="M6.5 7.75v1A2.25 2.25 0 0 0 8.75 11h6.5a2.25 2.25 0 0 0 2.25-2.25v-1H19v1a3.75 3.75 0 0 1-3.75 3.75h-6.5A3.75 3.75 0 0 1 5 8.75v-1h1.5z" fill="currentColor"/><path fill-rule="evenodd" d="M11.25 16.25v-5h1.5v5h-1.5z" fill="currentColor"/></svg>');var Pn=(e={})=>{const t=In.cloneNode(!0);return X(t,e,!0),t};const Hn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 6 16"><path fill-rule="evenodd" d="M0 14l6-6l-6-6v12z" fill="currentColor"/></svg>');var jn=(e={})=>{const t=Hn.cloneNode(!0);return X(t,e,!0),t};const Fn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 1200 1200"><path d="M304.102 295.898L0 600l304.102 304.102v-203.54h591.797v203.539L1200 600L895.898 295.898v203.539H304.102V295.898z" fill="currentColor"/></svg>');var mt=(e={})=>{const t=Fn.cloneNode(!0);return X(t,e,!0),t};const Yn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path d="M33 7.64c-1.34-2.75-5.2-5-9.69-3.69A9.87 9.87 0 0 0 18 7.72a9.87 9.87 0 0 0-5.31-3.77C8.19 2.66 4.34 4.89 3 7.64c-1.88 3.85-1.1 8.18 2.32 12.87C8 24.18 11.83 27.9 17.39 32.22a1 1 0 0 0 1.23 0c5.55-4.31 9.39-8 12.07-11.71c3.41-4.69 4.19-9.02 2.31-12.87z" class="clr-i-solid clr-i-solid-path-1" fill="currentColor"/></svg>');var pt=(e={})=>{const t=Yn.cloneNode(!0);return X(t,e,!0),t};const Gn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 3.172L5.586 9.586a2 2 0 1 0 2.828 2.828L10 10.828v7.242a2 2 0 0 0 4 0v-7.242l1.586 1.586c.391.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L12 3.172z" fill="currentColor"/></svg>');var Fe=(e={})=>{const t=Gn.cloneNode(!0);return X(t,e,!0),t};const Un=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18.414 10.656a2 2 0 0 0-2.828 0L14 12.242V5a2 2 0 0 0-4 0v7.242l-1.586-1.586a2 2 0 1 0-2.828 2.828L12 19.898l6.414-6.414a2 2 0 0 0 0-2.828z" fill="currentColor"/></svg>');var Ye=(e={})=>{const t=Un.cloneNode(!0);return X(t,e,!0),t};const Jn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18 11h-7.244l1.586-1.586a2 2 0 1 0-2.828-2.828L3.1 13l6.414 6.414c.39.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L10.756 15H18a2 2 0 0 0 0-4z" fill="currentColor"/></svg>');var Ge=(e={})=>{const t=Jn.cloneNode(!0);return X(t,e,!0),t};const Vn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M10.586 6.586a2 2 0 0 0 0 2.828L12.172 11H4.928a2 2 0 0 0 0 4h7.244l-1.586 1.586a2 2 0 1 0 2.828 2.828L19.828 13l-6.414-6.414a2 2 0 0 0-2.828 0z" fill="currentColor"/></svg>');var Ue=(e={})=>{const t=Vn.cloneNode(!0);return X(t,e,!0),t};const qn=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/></g></svg>');var Xn=(e={})=>{const t=qn.cloneNode(!0);return X(t,e,!0),t};const xe={pageBackground:"transparent",gridDot:"#6a208f",gridCellBackground:"#f1f1f1",gridCellBackgroundDark:"#D6D5EA",food:"#ff5c75",hazard:"#000000",hazardOpacity:"0.4",overlapSnake:"#AAAAAA",healthBar:"#0f0",healthBarBackground:"#fefefe",healthBarOutline:"#666",healthBarDeathBackground:"#f1f1f1",healthBarDeathBackgroundDark:"#59526b",lightText:"#efefef",darkText:"#222",blue:"#007bff",indigo:"#6610f2",purple:"#6f42c1",pink:"#e83e8c",red:"#dc3545",orange:"#fd7e14",yellow:"#ffc107",green:"#28a745",teal:"#20c997",cyan:"#17a2b8",white:"#fff",gray:"#6c757d",grayLight:"#f1f1f1",grayDark:"#343a40",primary:"#007bff",secondary:"#6c757d",success:"#28a745",info:"#17a2b8",warning:"#ffc107",danger:"#dc3545",light:"#f8f9fa",dark:"#343a40"},Wn=b("<svg></svg>"),Kn=b("<svg><rect></rect></svg>",4,!0);function bt(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}function Zn(e){const t=e.ctx,n=(t.cellSize+t.cellSpacing)*t.gameWidth+t.cellSpacing,s=(t.cellSize+t.cellSpacing)*t.gameHeight+t.cellSpacing;return(()=>{const o=Wn.cloneNode(!0);return C(o,"viewBox",`0 0 ${n} ${s}`),g(o,()=>bt(t.gameHeight).map((r,l)=>bt(t.gameWidth).map((i,c)=>(()=>{const v=Kn.cloneNode(!0),_=e.ref;return typeof _=="function"?_(v):e.ref=v,C(v,"data-x",c),C(v,"data-y",l),U(d=>{const h=t.toGridSpaceX(c),u=t.toGridSpaceY(l),w=t.cellSize,z=t.cellSize,T=xe.gridCellBackground;return h!==d._v$&&C(v,"x",d._v$=h),u!==d._v$2&&C(v,"y",d._v$2=u),w!==d._v$3&&C(v,"width",d._v$3=w),z!==d._v$4&&C(v,"height",d._v$4=z),T!==d._v$5&&C(v,"fill",d._v$5=T),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),v})())),null),g(o,()=>e.children,null),o})()}let x;(function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"})(x||(x={}));function Ne(e){return{type:"ok",value:e}}function wt(e){return{type:"error",msg:e}}const Qn=x.Up;async function er(e){const t=Re("head",e.headType),n=Re("tail",e.tailType),s=e.body.filter((o,r)=>yt(e,r));return Object.assign({},e,{parts:e.body.map((o,r)=>tr(e,r)),effectiveSpace:s.length,headSvg:await t,tailSvg:await n})}function tr(e,t){const n=e.body[t],s=rr(e,t),{x:o,y:r}=n,l=nr(s,e,n,t),i=yt(e,t)?void 0:!0;return{direction:l,type:s,isOverlapped:i,x:o,y:r,shadeForOverlap:!1}}function yt(e,t){const n=0,s=e.body.length-1,o=e.body[n],r=e.body[s],l=e.body[t];if(t===n)return!0;if(t===s)return!(o.x===l.x&&o.y===l.y);const i=e.body[t-1];return!(r.x===l.x&&r.y===l.y)&&!(o.x===l.x&&o.y===l.y)&&!(i&&i.x===l.x&&i.y===l.y)}function nr(e,t,n,s){let o;if(t.body.length==1)o=x.Up;else if(e===oe.HEAD)o=xt(t.body[1],t.body[0]);else{let r;do r=t.body[Math.max(s-1,0)],--s;while(s>0&&r.x===n.x&&r.y===n.y);o=xt(n,r)}return o}function xt(e,t){return e.x<t.x?x.Right:e.x>t.x?x.Left:e.y>t.y?x.Down:e.y<t.y?x.Up:Qn}let oe;(function(e){e[e.HEAD=0]="HEAD",e[e.TAIL=1]="TAIL",e[e.BODY=2]="BODY"})(oe||(oe={}));function rr(e,t){return t===0?oe.HEAD:t===e.body.length-1?oe.TAIL:oe.BODY}const sr=b("<svg><g></g></svg>",4,!0),$t=b("<svg><rect></rect></svg>",4,!0),or=b("<svg><path></path></svg>"),lr=b('<svg><g class="pointer-events-none"></g></svg>',4,!0),ir=.1,ar=.3,cr=.8,dr=1,_t=[x.Up,x.Right,x.Down,x.Left];var le;(function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomRight=2]="BottomRight",e[e.BottomLeft=3]="BottomLeft"})(le||(le={}));function ur(e,t){const n=e.direction===x.Left||e.direction===x.Right?2*t.cellSpacing:0;return t.cellSize+n}function gr(e,t){const n=e.direction===x.Up||e.direction===x.Down?2*t.cellSpacing:0;return t.cellSize+n}function hr(e,t){const n=e.direction===x.Left||e.direction===x.Right?-t.cellSpacing:0;return t.toGridSpaceX(e.x)+n}function fr(e,t){const n=e.direction===x.Up||e.direction===x.Down?-t.cellSpacing:0;return t.toGridSpaceY(e.y)+n}function vr(e,t){return t.toGridSpaceX(e.x)-t.cellSpacing}function mr(e,t){return t.toGridSpaceY(e.y)-t.cellSpacing}function pr(e,t){switch(e.direction){case x.Left:return t.toGridSpaceX(e.x+1)-t.cellSpacing;case x.Right:return t.toGridSpaceX(e.x)-t.cellSpacing;default:return t.toGridSpaceX(e.x)}}function br(e,t){switch(e.direction){case x.Up:return t.toGridSpaceY(e.y-1)-t.cellSpacing;case x.Down:return t.toGridSpaceY(e.y)-t.cellSpacing;default:return t.toGridSpaceY(e.y)}}function wr(e,t){return e.direction===x.Left||e.direction===x.Right?t.cellSpacing:t.cellSize}function yr(e,t){return e.direction===x.Left||e.direction===x.Right?t.cellSize:t.cellSpacing}function Me(e){return!!e.death}function xr(e){return Me(e)?ir:1}function Ae(e){return e.shadeForOverlap?cr:e.isOverlapped?ar:dr}function Be(e,t){return t.shadeForOverlap?xe.overlapSnake:e.color}function $r(e){return e.concat().sort((t,n)=>{const s=Me(t)?0:1,o=Me(n)?0:1;return s-o})}function St(e,t){switch(e){case x.Left:return`scale(1,-1) rotate(180) translate(-${t} 0)`;case x.Up:return`rotate(270) translate(-${t} 0)`;case x.Down:return`rotate(90) translate(-${t} 0)`;default:return`translate(-${t} 0)`}}function kt(e,t){switch(e){case x.Right:return`rotate(180) translate(-${t} 0)`;case x.Down:return`rotate(270) translate(-${t} 0)`;case x.Up:return`rotate(90) translate(-${t} 0)`;default:return`translate(-${t} 0)`}}function _r(e,t){return Math.abs(_t.indexOf(e)-_t.indexOf(t))%2==1}function Sr(e,t){if(t===0||t===e.parts.length-1)return!1;const n=e.parts[t+1],s=e.parts[t];return n.x===s.x&&n.y===s.y?!1:_r(s.direction,n.direction)}function kr(e,t){if(e.parts[t].type!=oe.BODY)throw new Error("do not call determineCornerType on a non body part");const n=e.parts[t].direction,s=e.parts[t+1].direction;if(n==x.Up&&s==x.Right||n==x.Left&&s==x.Down)return le.TopLeft;if(n==x.Up&&s==x.Left||n==x.Right&&s==x.Down)return le.TopRight;if(n==x.Down&&s==x.Left||n==x.Right&&s==x.Up)return le.BottomRight;if(n==x.Down&&s==x.Right||n==x.Left&&s==x.Up)return le.BottomLeft;throw new Error("unreachable")}function Tt(e,t){const n=e.body[e.body.length-1];return t.isOverlapped&&n.x===t.x&&n.y===t.y}function Tr(e,t,n,s,o){if(!Tt(e,n))switch(n.type){case oe.HEAD:return Cr(e,t,n,o);case oe.TAIL:return zr(e,t,n,o);case oe.BODY:return Sr(e,s)?Lr(e,t,n,s,o):Rr(e,t,n,s,o)}}function Cr(e,t,n,s){const o=s.toGridSpaceX(n.x),r=s.toGridSpaceY(n.y),l=e.headSvg,i=St(n.direction,0),c=Be(e,n),v=Ae(n),_=d=>{d.setAttribute("transform",i),Ie(()=>{const h=d.getBoundingClientRect(),u=1*(100/h.width);d.setAttribute("transform",St(n.direction,u))})};return(()=>{const d=sr.cloneNode(!0);return g(d,a(l,{x:o,y:r,get width(){return s.cellSize},get height(){return s.cellSize},opacity:v,"transform-origin":"center",style:"transform-box: fill-box",fill:c,ref(h){const u=_;typeof u=="function"?u(h):_=h}}),null),g(d,(()=>{const h=ke(()=>e.effectiveSpace>1,!0);return()=>h()&&(()=>{const u=$t.cloneNode(!0);return C(u,"fill",c),C(u,"opacity",v),U(w=>{const z=pr(n,s),T=br(n,s),O=wr(n,s),W=yr(n,s);return z!==w._v$&&C(u,"x",w._v$=z),T!==w._v$2&&C(u,"y",w._v$2=T),O!==w._v$3&&C(u,"width",w._v$3=O),W!==w._v$4&&C(u,"height",w._v$4=W),w},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),u})()})(),null),d})()}function Rr(e,t,n,s,o){const r=Be(e,n),l=Ae(n);return(()=>{const i=$t.cloneNode(!0);return C(i,"fill",r),C(i,"opacity",l),U(c=>{const v=hr(n,o),_=fr(n,o),d=ur(n,o),h=gr(n,o);return v!==c._v$5&&C(i,"x",c._v$5=v),_!==c._v$6&&C(i,"y",c._v$6=_),d!==c._v$7&&C(i,"width",c._v$7=d),h!==c._v$8&&C(i,"height",c._v$8=h),c},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),i})()}function Lr(e,t,n,s,o){const r="M0,20 h60 a60,60 0 0 1 60,60 v60 h-100 v-20 h-20 z",l=Be(e,n),i=Ae(n),c="0 0 140 140";let v;switch(kr(e,s)){case le.BottomRight:v="rotate(270, 70, 70)";break;case le.TopLeft:v="rotate(90, 70, 70)";break;case le.BottomLeft:break;case le.TopRight:v="rotate(180, 70, 70)";break}return(()=>{const d=or.cloneNode(!0),h=d.firstChild;return C(d,"fill",l),C(d,"opacity",i),C(d,"viewBox",c),C(h,"d",r),C(h,"transform",v),U(u=>{const w=vr(n,o),z=mr(n,o),T=o.cellSize+2*o.cellSpacing,O=o.cellSize+2*o.cellSpacing;return w!==u._v$9&&C(d,"x",u._v$9=w),z!==u._v$10&&C(d,"y",u._v$10=z),T!==u._v$11&&C(d,"width",u._v$11=T),O!==u._v$12&&C(d,"height",u._v$12=O),u},{_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),d})()}function zr(e,t,n,s){const o=s.toGridSpaceX(n.x),r=s.toGridSpaceY(n.y),l=e.tailSvg,i=kt(n.direction,0),c=Be(e,n),v=Ae(n),_=d=>{d.setAttribute("transform",i),Ie(()=>{const h=d.getBoundingClientRect(),u=1*(100/h.width);d.setAttribute("transform",kt(n.direction,u))})};return a(l,{x:o,y:r,get width(){return s.cellSize},get height(){return s.cellSize},opacity:v,"transform-origin":"center",style:"transform-box: fill-box",fill:c,ref(d){const h=_;typeof h=="function"?h(d):_=d}})}async function Nr(e,t){const n=await Promise.all($r(t).map(o=>er(o))),s=Array(e.gameHeight);for(let o=0;o<s.length;o++){s[o]=Array(e.gameWidth);for(let r=0;r<e.gameWidth;r++)s[o][r]=!1}for(let o=0;o<n.length;o++){const r=n[o];if(!Me(r))for(let l=0;l<r.parts.length;l++){const i=r.parts[l];Tt(r,i)||(s[i.y][i.x]?i.shadeForOverlap=!0:s[i.y][i.x]=!0)}}return n}function Mr(e){const t=e.ctx,n=fe(()=>e.frame.snakes||[]),[s]=De(n,o=>Nr(t,o));return a(de,{get when(){return!s.loading},get children(){return s().map((o,r)=>(()=>{const l=lr.cloneNode(!0);return g(l,()=>[...o.parts].reverse().map((i,c)=>Tr(o,r,i,o.parts.length-c-1,t))),U(()=>C(l,"opacity",xr(o))),l})())}})}const Ar=b('<svg><circle class="pointer-events-none"></circle></svg>',4,!0);function Br(e){const t=e.ctx,n=(t.cellSize/3.25).toFixed(2),s=fe(()=>e.frame.food||[]);return a(ye,{get each(){return s()},children:o=>(()=>{const r=Ar.cloneNode(!0);return C(r,"r",n),U(l=>{const i=t.toGridSpaceX(o.x)+t.cellSize/2,c=t.toGridSpaceY(o.y)+t.cellSize/2,v=xe.food;return i!==l._v$&&C(r,"cx",l._v$=i),c!==l._v$2&&C(r,"cy",l._v$2=c),v!==l._v$3&&C(r,"fill",l._v$3=v),l},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})()})}const Er=b('<svg><rect class="pointer-events-none"></rect></svg>',4,!0),Dr=parseFloat(xe.hazardOpacity);function Or(e){const t=e.ctx,n=fe(()=>e.frame.hazards||[]);return a(ye,{get each(){return n()},children:s=>(()=>{const o=Er.cloneNode(!0);return C(o,"fill-opacity",Dr),U(r=>{const l=t.toGridSpaceX(s.x),i=t.toGridSpaceY(s.y),c=t.cellSize,v=t.cellSize,_=xe.hazard;return l!==r._v$&&C(o,"x",r._v$=l),i!==r._v$2&&C(o,"y",r._v$2=i),c!==r._v$3&&C(o,"width",r._v$3=c),v!==r._v$4&&C(o,"height",r._v$4=v),_!==r._v$5&&C(o,"fill",r._v$5=_),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),o})()})}const Je=100,$e=20;function Ir(e){const t={cellSize:Je,cellSpacing:$e,gameWidth:e.game.width,gameHeight:e.game.height,toGridSpaceX:n=>(Je+$e)*n+$e,toGridSpaceY:n=>(Je+$e)*(e.game.height-1-n)+$e};return a(Zn,{ctx:t,ref(n){const s=e.ref;typeof s=="function"?s(n):e.ref=n},get children(){return[a(Mr,{ctx:t,get frame(){return e.frame}}),a(Br,{ctx:t,get frame(){return e.frame}}),a(Or,{ctx:t,get frame(){return e.frame}})]}})}const Pr="_Board_1okyx_1";var Hr={Board:Pr};const jr=b("<div></div>");function Ct(e){const[t,n]=it(e,["frame","game","ref"]),s=jt({ref:()=>{}},t);return(()=>{const o=jr.cloneNode(!0);return X(o,n,!1,!0),g(o,a(Ir,s)),U(r=>Oe(o,{[Hr.Board]:!0},r)),o})()}const Fr=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8L4.646 5.354a.5.5 0 0 1 0-.708z"/></g></svg>');var Yr=(e={})=>{const t=Fr.cloneNode(!0);return X(t,e,!0),t};const Gr=b('<div class="absolute inset-0 flex items-center justify-center"><div class="bg-black opacity-25 absolute inset-0"></div><div class="flex flex-col bg-white rounded w-6/12 h-1/4 border shadow text-center z-0"><div class="flex flex-row items-center justify-between py-2 px-4 border-b border-gray-200"><p class="font-semibold text-gray-800"></p></div></div></div>');function Rt(e){const[t,n]=e.switch,s=()=>n(!1),o=r=>{r.key=="Escape"&&s()};return document.addEventListener("keydown",o),Ft(()=>{document.removeEventListener("keydown",o)}),a(de,{get when(){return t()},get children(){return a(Yt,{get children(){const r=Gr.cloneNode(!0),l=r.firstChild,i=l.nextSibling,c=i.firstChild,v=c.firstChild;return l.$$click=s,g(v,()=>e.title),g(c,a(Yr,{onclick:s,class:"cursor-pointer"}),null),g(i,()=>e.children,null),r}})}})}ge(["click"]);const Ur=b('<div class="flex flex-col m-4 bg-white shadow"></div>'),Jr=b('<div class="fixed inset-0 h-full w-full z-10"></div>'),Vr=b('<div class="absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-md z-20 border border-gray-100"><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">export as curl</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">export as JSON</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">edit board</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-red-700 hover:bg-yellow-100">delete</button></div>'),qr=b('<div style="border-bottom:1px solid rgba(210,221,234,.5)" class="flex items-center justify-between px-4 py-4"><input type="text" class="border border-opacity-0 border-gray-300 rounded hover:border-opacity-100 cursor-default hover:cursor-text focus-within:cursor-text w-full overflow-ellipsis"><div class="relative"><button class="relative block rounded-md bg-white p-2 ml-1 border border-white hover:border-gray-200 focus:outline-none"></button></div></div>'),Xr=b('<div class="flex items-start flex-wrap p-6"><div class="inline-block"><div class="flex items-center mr-1"><div class="flex-1"><span>Turn:</span><input class="py-0 w-24 text-center focus:ring-0 border-none" type="number"></div><button title="test this turn" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="clone this test" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div></div><table></table></div>'),Wr=b('<div class="p-6"><p class="text-gray-900"><span class="inline-block w-24">Tested:</span><span>Turn </span></p><p><span class="inline-block w-24 text-gray-800">Answered:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><span class="text-red-500"></span></p></div>'),Kr=b('<div class="p-6"><div class="flex items-center text-gray-900"><span class="inline-block w-24">Saved test:</span><span>Turn </span><button title="use current turn for saved test" class="mx-3 text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div><div class="flex items-center"><span class="inline-block w-24 text-gray-800">Expected:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button></div><div class="flex items-center my-2"><span class="inline-block w-24 text-gray-800">Answered:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><span class="text-red-500"></span></div><button class="bg-blue-400 text-white mt-2 px-2 font-bold rounded">Run Test</button></div>'),Lt=b('<div class="flex-1 p-4"></div>'),Zr=b('<tr><td></td><td class="pr-2 py-1"></td><td class="text-right tabular-nums"></td><td></td><td class="text-right tabular-nums w-10"></td><td></td></tr>'),zt=b('<textarea readonly class="w-full h-full border-gray-200"></textarea>');function Qr(e){const t=e.mySnakeStyle,n=e.testResult,[s,o]=K(),[r,l]=K(0),[i,c]=K(),v=$=>()=>(s()||(()=>{throw new Error("!")})())[$],_=($,f)=>{const p=s()||(()=>{throw new Error("!")})();o({...p,[$]:f})},d=$=>f=>{_($,f);const p=s()||(()=>{throw new Error("!")})();e.saveTest(p)};be(async()=>{const $=n().id,f=await e.readTest($),p=s(),L=p?.id==$?r():f.frameToTest;ct(()=>{l(L),o(f),$!=p?.id&&c(void 0)})});const h=fe(()=>{const $=s(),f=$?.frames.find(p=>p.turn==r());if($&&f){const p=f.snakes.map(V=>({...V})),L=p[$.snakeToTest];return L&&Object.assign(L,t()),{...f,snakes:p}}}),u=fe(()=>{const $=s(),f=h();if($&&f){const p=$.frames,L=p[p.length-1],V=L.snakes.map(M=>M.death?M.death.turn:L.turn+1),Q=f.snakes.map((M,E)=>({...M,idx:E})),R=Gt(Q,V);return at(M=>-M[1],R).map(M=>M[0])}return[]}),w=$=>{const f=s();if(f){const p=$.target,L=p.value.trim()!=""?+p.value:0,V=f.frames[0].turn,R=f.frames[f.frames.length-1].turn,B=Math.max(V,Math.min(L,R));p.value=p.value.trim()!=""?B.toString():"",l(B)}},[z,T]=K(!1),O=($,...f)=>()=>{T(!1),$(...f)},[W,A]=K(!1),[ee,j]=K(!1),Y=$=>{const f=n();return f.result.type=="passed"&&f.result.move==$},y=$=>{const f=n();return f.result.type=="failed"&&f.result.move==$},m=()=>{const $=n();return $.result.type=="failed"&&!$.result.move?$.result.msg:""},S=$=>()=>{const f=s()||(()=>{throw new Error("!")})(),p=f.expectedResult.includes($)?f.expectedResult.filter(V=>V!=$):f.expectedResult.concat($);_("expectedResult",p);const L=s();e.saveTest(L)},I=$=>()=>{_("snakeToTest",$);const f=s()||(()=>{throw new Error("!")})();e.saveTest(f)},N=()=>{_("frameToTest",r());const $=s()||(()=>{throw new Error("!")})();e.saveTest($)},P=()=>{const $=s()||(()=>{throw new Error("!")})(),f=Te($);f.id=ve(10),f.timestamp=Date.now(),f.description="(cloned) "+$.description,f.frameToTest=r(),e.saveTest(f),o(f)},J=async()=>{const $=s()||(()=>{throw new Error("!")})(),f=Te($);f.frameToTest=r(),f.expectedResult=["Up","Down","Left","Right"];const p=await e.runUnsavedTest(f);c({turn:f.frameToTest,move:p.move,msg:p.type=="failed"?p.msg:void 0})};return(()=>{const $=Ur.cloneNode(!0);return g($,a(de,{get when(){return s()},children:f=>[(()=>{const p=qr.cloneNode(!0),L=p.firstChild,V=L.nextSibling,Q=V.firstChild;return L.$$keydown=R=>{R.key=="Enter"&&R.target.blur()},Ce(L,()=>gt(v("description"),d("description"))),Q.$$click=()=>T(!z()),g(Q,a(dt,{class:"text-gray-500"})),g(V,a(de,{get when(){return z()},get children(){return[(()=>{const R=Jr.cloneNode(!0);return R.$$click=()=>T(!1),R})(),(()=>{const R=Vr.cloneNode(!0),B=R.firstChild,M=B.nextSibling,E=M.nextSibling,F=E.nextSibling;return B.$$click=()=>{A(!0),T(!1)},M.$$click=()=>{j(!0),T(!1)},E.$$click=()=>{e.setView("builder"),T(!1)},he(F,"click",O(e.deleteTest,f.id),!0),R})()]}}),null),U(()=>L.value=f.description),p})(),(()=>{const p=Xr.cloneNode(!0),L=p.firstChild,V=L.firstChild,Q=V.firstChild,R=Q.firstChild,B=R.nextSibling,M=Q.nextSibling,E=M.nextSibling,F=L.nextSibling;return g(L,a(de,{get when(){return h()},children:D=>a(Ct,{get game(){return f.game},frame:D})}),V),B.$$input=D=>w(D),M.$$click=J,g(M,a(On,{})),E.$$click=P,g(E,a(Pn,{})),g(F,a(ye,{get each(){return u()},children:D=>{const te=D.death?.3:1;return(()=>{const q=Zr.cloneNode(!0),ce=q.firstChild,G=ce.nextSibling,re=G.nextSibling,ne=re.nextSibling,ue=ne.nextSibling,Se=ue.nextSibling;return g(ce,a(jn,{class:"text-gray-300",get classList(){return{"text-blue-400":D.idx==f.snakeToTest}},get onclick(){return I(D.idx)}})),G.style.setProperty("font-size",0),G.style.setProperty("opacity",te),g(G,a(ze,{get color(){return D.color},get head(){return D.headType},get tail(){return D.tailType}})),re.style.setProperty("opacity",te),g(re,()=>D.body.length),ne.style.setProperty("opacity",te),g(ne,a(mt,{class:"text-gray-500"})),ue.style.setProperty("opacity",te),g(ue,()=>D.health),Se.style.setProperty("opacity",te),g(Se,a(pt,{class:"text-red-500"})),q})()}})),U(()=>B.value=r()),p})(),a(de,{get when(){return i()},get children(){const p=Wr.cloneNode(!0),L=p.firstChild,V=L.firstChild,Q=V.nextSibling;Q.firstChild;const R=L.nextSibling,B=R.firstChild,M=B.nextSibling,E=M.nextSibling,F=E.nextSibling,D=F.nextSibling,te=D.nextSibling;return g(Q,()=>i()?.turn,null),g(M,a(Fe,{})),g(E,a(Ye,{})),g(F,a(Ge,{})),g(D,a(Ue,{})),g(te,()=>i().msg),U(q=>{const ce=i().move=="Up",G=i().move=="Down",re=i().move=="Left",ne=i().move=="Right";return ce!==q._v$&&M.classList.toggle("bg-green-400",q._v$=ce),G!==q._v$2&&E.classList.toggle("bg-green-400",q._v$2=G),re!==q._v$3&&F.classList.toggle("bg-green-400",q._v$3=re),ne!==q._v$4&&D.classList.toggle("bg-green-400",q._v$4=ne),q},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),p}}),(()=>{const p=Kr.cloneNode(!0),L=p.firstChild,V=L.firstChild,Q=V.nextSibling;Q.firstChild;const R=Q.nextSibling,B=L.nextSibling,M=B.firstChild,E=M.nextSibling,F=E.nextSibling,D=F.nextSibling,te=D.nextSibling,q=B.nextSibling,ce=q.firstChild,G=ce.nextSibling,re=G.nextSibling,ne=re.nextSibling,ue=ne.nextSibling,Se=ue.nextSibling,It=q.nextSibling;return g(Q,()=>f.frameToTest,null),R.$$click=N,g(R,a(Xn,{})),he(E,"click",S("Up"),!0),g(E,a(Fe,{})),he(F,"click",S("Down"),!0),g(F,a(Ye,{})),he(D,"click",S("Left"),!0),g(D,a(Ge,{})),he(te,"click",S("Right"),!0),g(te,a(Ue,{})),g(G,a(Fe,{})),g(re,a(Ye,{})),g(ne,a(Ge,{})),g(ue,a(Ue,{})),g(Se,m),It.$$click=()=>e.runSingleTest(f.id),U(H=>{const qe=f.expectedResult.includes("Up"),Xe=f.expectedResult.includes("Down"),We=f.expectedResult.includes("Left"),Ke=f.expectedResult.includes("Right"),Ze=Y("Up"),Qe=y("Up"),et=Y("Down"),tt=y("Down"),nt=Y("Left"),rt=y("Left"),st=Y("Right"),ot=y("Right");return qe!==H._v$5&&E.classList.toggle("bg-blue-400",H._v$5=qe),Xe!==H._v$6&&F.classList.toggle("bg-blue-400",H._v$6=Xe),We!==H._v$7&&D.classList.toggle("bg-blue-400",H._v$7=We),Ke!==H._v$8&&te.classList.toggle("bg-blue-400",H._v$8=Ke),Ze!==H._v$9&&G.classList.toggle("bg-green-400",H._v$9=Ze),Qe!==H._v$10&&G.classList.toggle("bg-red-400",H._v$10=Qe),et!==H._v$11&&re.classList.toggle("bg-green-400",H._v$11=et),tt!==H._v$12&&re.classList.toggle("bg-red-400",H._v$12=tt),nt!==H._v$13&&ne.classList.toggle("bg-green-400",H._v$13=nt),rt!==H._v$14&&ne.classList.toggle("bg-red-400",H._v$14=rt),st!==H._v$15&&ue.classList.toggle("bg-green-400",H._v$15=st),ot!==H._v$16&&ue.classList.toggle("bg-red-400",H._v$16=ot),H},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0,_v$16:void 0}),p})(),a(Rt,{title:"Export as curl",switch:[W,A],get children(){const p=Lt.cloneNode(!0);return g(p,()=>(()=>{const L=zt.cloneNode(!0);return g(L,()=>e.asCurl(s())),L})()),p}}),a(Rt,{title:"Export as json",switch:[ee,j],get children(){const p=Lt.cloneNode(!0);return g(p,()=>(()=>{const L=zt.cloneNode(!0);return g(L,()=>e.asJson(s())),L})()),p}})]})),$})()}ge(["keydown","click","input"]);const es=b(`<div class="text-center"><p class="text-gray-500">You don't have any tests yet. You can create one by importing a game, or just import some examples to get started.</p><button class="mt-2 bg-blue-400 text-white px-2 font-bold rounded">Import examples</button></div>`),ts=b('<button class="bg-blue-400 text-white px-2 font-bold rounded">Run all tests</button>'),ns=b('<p class="text-red-500"></p>'),rs=b("<ul></ul>"),ss=b('<div class="flex flex-col w-full"><div class="flex flex-0 justify-between mb-4"><p class="font-bold text-gray-500">Tests available:</p></div><div class="overflow-y-auto"></div></div>'),os=b('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#D9D9D9"></circle></svg>'),ls=b('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#A7F3D0"></circle><path d="M18 8l-8 8-4-4" stroke="#047857" stroke-width="2"></path></svg>'),is=b('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#FECDD3"></circle><path d="M8 8l8 8M16 8l-8 8" stroke="#B91C1C" stroke-width="2"></path></svg>'),as=b('<li class="flex items-center px-2 py-2 font-medium leading-5"><span class="truncate"></span></li>');function cs(e){const[t,n]=e.selected,s=e.setView,o=e.testResults,r=Ut(t),l=v=>{ct(()=>{n(v),s("test")})},i=v=>{be(()=>v.querySelectorAll("li")[t()]?.scrollIntoView({block:"nearest"}))},c=()=>(()=>{const v=es.cloneNode(!0),_=v.firstChild,d=_.nextSibling;return d.$$click=()=>e.importExamples(),v})();return(()=>{const v=ss.cloneNode(!0),_=v.firstChild;_.firstChild;const d=_.nextSibling;g(_,(()=>{const u=ke(()=>e.dbStatus().type=="done",!0);return a(de,{get when(){return u()&&o().length>0},get children(){const w=ts.cloneNode(!0);return he(w,"click",e.runAllTests,!0),w}})})(),null);const h=i;return typeof h=="function"?h(d):i=d,g(d,a(we,{get children(){return[a(Z,{get when(){return e.dbStatus().type=="loading"},children:"loading..."}),a(Z,{get when(){return e.dbStatus().type=="error"},get children(){const u=ns.cloneNode(!0);return g(u,()=>{const w=e.dbStatus();return w.type=="error"&&w.message}),u}}),a(Z,{get when(){return e.dbStatus().type=="done"},get children(){const u=rs.cloneNode(!0);return g(u,a(ye,{get each(){return o()},fallback:c,children:(w,z)=>(()=>{const T=as.cloneNode(!0),O=T.firstChild;return T.$$click=()=>l(z()),g(T,a(we,{get children(){return[a(Z,{get when(){return w.result.type=="pending"},get children(){return os.cloneNode(!0)}}),a(Z,{get when(){return w.result.type==="passed"},get children(){return ls.cloneNode(!0)}}),a(Z,{get when(){return w.result.type==="failed"},get children(){return is.cloneNode(!0)}})]}}),O),g(O,()=>w.description),U(()=>T.classList.toggle("bg-yellow-100",r(z()))),T})()})),u}})]}})),v})()}ge(["click"]);const ds=b(`<div class="flex flex-col m-4 p-6 bg-white max-w-4xl text-gray-700 shadow"><h1 class="py-4 text-2xl text-gray-500 font-semibold">Welcome!</h1><p>This app allow you to import games played in <a target="_blank" class="text-purple-600" href="https://play.battlesnake.com/">https://play.battlesnake.com/</a>, navigate all the turns and create tests for your server. The tests created are saved locally in your browser in a IndexedDB database.</p><h2 class="py-4 text-xl">Get's start</h2><ul><li>1.- config your server on the top left input.</li><li>2.- create a new test importing a game from <a target="_blank" class="text-purple-600" href="https://play.battlesnake.com/">https://play.battlesnake.com/</a>.</li><li>3.- Set the name and expected result.</li></ul><p class="my-2">That's all! You can run a single test or all at once.</p><p class="mt-4">This project is in active development. Visit the <a target="_blank" class="text-purple-600" href="https://github.com/jfgodoy/battlesnake-tester">github repository</a> and leave suggestions of new features.</p></div>`);function us(){return ds.cloneNode(!0)}const gs=b('<div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">DB Exporter</h3><div class="flex my-4"><div class="space-y-2"><div><p>Create a backup of all your tests for example to migrate to another browser, share with friends, or offline processing.</p><button class="bg-blue-400 text-white mt-2 px-2 font-bold rounded">Generate backup</button></div></div></div></div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">DB Importer</h3><div class="my-4"><div><div><input type="radio" name="mode" id="add" value="add" checked><label for="add" class="ml-2">Keep existing tests</label></div><div><input type="radio" name="mode" id="replace" value="replace"><label for="replace" class="ml-2">Remove existing tests</label></div></div><div class="mt-2"><label for="files" class="bg-blue-400 text-white text-base mt-2 px-2 py-1 font-bold rounded">Import backup file</label><input id="files" style="visibility:hidden;" type="file" accept="application/json"><p></p></div></div></div></div>');function hs(e){async function t(){const i=await e.exportToJson(),c=JSON.stringify(i,null,2),v=new Blob([c],{type:"application/json;charset=utf-8"});Jt.exports.saveAs(v,"battlesnake-tester-db.json")}const[n,s]=K("add"),[o,r]=K("");async function l(i){r("");const v=i.target.files;if(!v||v.length==0)return;const _=v[0];r("loading...");const d=await new Promise((h,u)=>{const w=new FileReader;w.onload=function(){try{const z=JSON.parse(w.result);h(z)}catch(z){r("file must be json"),u(z)}},w.readAsText(_)});try{const h=k.object.exactShape({version:k.string.equals("1"),tests:k.array.ofType(ft)});k(d,h)}catch(h){r(h.message);return}e.importFromJson(d,{mode:n()}).then(()=>r("file imported!")).catch(h=>r(`Error: ${h.message}`))}return(()=>{const i=gs.cloneNode(!0),c=i.firstChild,v=c.firstChild,_=v.nextSibling,d=_.firstChild,h=d.firstChild,u=h.firstChild,w=u.nextSibling,z=c.nextSibling,T=z.firstChild,O=T.nextSibling,W=O.firstChild,A=W.firstChild,ee=A.firstChild,j=A.nextSibling,Y=j.firstChild,y=W.nextSibling,m=y.firstChild,S=m.nextSibling,I=S.nextSibling;return w.$$click=t,ee.$$input=()=>s("add"),Y.$$input=()=>s("replace"),S.$$input=l,g(I,o),i})()}ge(["click","input"]);const fs="modulepreload",Nt={},vs="/battlesnake-tester/",Mt=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${vs}${s}`,s in Nt)return;Nt[s]=!0;const o=s.endsWith(".css"),r=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":fs,o||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),o)return new Promise((i,c)=>{l.addEventListener("load",i),l.addEventListener("error",c)})})).then(()=>t())};function ms(){let e=!1;const t="Tests",n=Vt("TestStorage",1,{async upgrade(r,l){r.createObjectStore(t,{keyPath:"id"}),l==0&&(e=!0)}}).then(async r=>{if(e){const l=(await Mt(()=>import("./examples.d6107786.js"),[])).default,i=r.transaction(t,"readwrite").objectStore(t);await Promise.all(l.map(c=>i.put(c)))}return r}),s=[],o=(r,l)=>s.forEach(i=>i(r,l));return{async list(){let l=await(await n).transaction(t).store.openCursor();const i=[];for(;l;)i.push({id:l.value.id,description:l.value.description,timestamp:l.value.timestamp}),l=await l.continue();return at(c=>c.timestamp,i)},async save(r){const i=(await n).transaction(t,"readwrite").objectStore(t),c=await i.get(r.id);await i.put(r),o(c,r)},async delete(r){const i=(await n).transaction(t,"readwrite").objectStore(t),c=await i.get(r);await i.delete(r),o(c,void 0)},async read(r){return(await n).transaction(t).objectStore(t).get(r)},suscribe(r){s.push(r)},async exportToJson(){let l=await(await n).transaction(t).store.openCursor();const i={version:"1",tests:[]};for(;l;)i.tests.push(l.value),l=await l.continue();return i},async importFromJson(r,l){const c=(await n).transaction(t,"readwrite").objectStore(t);l.mode=="replace"&&c.clear();const v=r.tests.map(_=>c.put(_));await Promise.all(v)}}}function ps(e,t){const n={body:JSON.stringify(t),method:"POST",mode:"cors",headers:[["content-type","application/json"]]};return fetch(e,n).then(s=>s.json()).then(s=>{switch(s.move){case"up":return Ne(x.Up);case"down":return Ne(x.Down);case"left":return Ne(x.Left);case"right":return Ne(x.Right);default:return wt("invalid move")}}).catch(s=>(console.log(s),wt("invalid move")))}function At(e){return{id:e.id,name:e.name,health:e.health,body:e.body,latency:+e.latency,head:e.body[0],length:e.body.length,shout:e.shout,squad:e.squad}}function Bt(e){const t=e.frames.find(l=>l.turn==e.frameToTest);if(!t)return"frame to test not found";const n=t.snakes[e.snakeToTest];if(!n)return"snake to test not found";if(n.death)return"Omae Wa Mou Shindeiru";const s=At(n),o=t.snakes.filter(l=>!l.death).map(At);return{board:{food:t.food,snakes:o,width:e.game.width,height:e.game.height,hazards:t.hazards},game:{id:e.game.id,ruleset:e.game.ruleset,timeout:e.game.timeout},turn:t.turn,you:s}}async function Ve(e,t){const n=Bt(t);if(typeof n=="string")return{type:"failed",msg:n};const s=await ps(e,n),o=t.expectedResult;switch(s.type){case"ok":{const r=x[s.value];return o.indexOf(r)>=0?{type:"passed",move:r}:{type:"failed",move:r,msg:"incorrect move"}}case"error":return{type:"failed",msg:s.msg}}}const ie=ms(),bs={server:"http://localhost:8080",testedSnake:{style:void 0},testResults:[],selected:0,view:"home",dbStatus:{type:"loading"}},[ae,me]=function(){const t=JSON.parse(localStorage.getItem("state")||"{}"),n=Object.assign({},bs,t),[s,o]=qt(n),r=(...l)=>{const i=o.call(null,...l),c=JSON.parse(localStorage.getItem("state")||"{}");return c.server=s.server,c.selected=s.selected,c.view=s.view,localStorage.setItem("state",JSON.stringify(c)),i};return ie.list().then(l=>{const i=l.map(c=>({...c,result:{type:"pending"}}));r("testResults",i),r("dbStatus",{type:"done"})}).catch(l=>{r("dbStatus",{type:"error",message:l.message})}),ie.suscribe((l,i)=>{if(!l&&i){const c={id:i.id,description:i.description,timestamp:i.timestamp,result:{type:"pending"}};r("testResults",v=>[...v,c]),r("selected",s.testResults.length-1)}if(l&&!i){const c=s.testResults.filter(v=>v.id!=l.id);r("testResults",c),r("selected",Math.min(s.testResults.length-1,s.selected))}if(l&&i){const c=()=>{const d=s.testResults.find(w=>w.id==i.id)?.result||{type:"pending"};if(d.type=="pending")return d;const h=d.move;return h?i.expectedResult.includes(h)?{type:"passed",move:h}:{type:"failed",move:h,msg:"incorrect move"}:{type:"failed",msg:d.msg}},v={id:i.id,description:i.description,timestamp:i.timestamp,result:c()},_=s.testResults.map(d=>d.id==i.id?v:d);r("testResults",_)}}),[s,r]}(),Ee=fe(()=>ae.testResults[ae.selected]);async function ws(e){const t=await ie.read(e),n=await Ve(`${ae.server}/move`,t),s=ae.testResults.findIndex(o=>o.id==e);return s>=0&&me("testResults",s,"result",{...{type:void 0,move:void 0,msg:void 0},...n}),n}async function ys(){const e=ae.testResults.map(o=>o.id),t=e.map(o=>ie.read(o)).map(o=>o.then(r=>Ve(`${ae.server}/move`,r))),n=await Promise.all(t),s=ae.testResults.map(o=>{const r=e.indexOf(o.id);return r>=0?{...o,result:n[r]}:o});me("testResults",s)}function xs(e){return Ve(`${ae.server}/move`,e)}const _e=e=>ie.save(e),Et=e=>ie.read(e),$s=e=>ie.delete(e),_s=()=>ie.exportToJson(),Ss=async(e,t)=>{await ie.importFromJson(e,t),ie.list().then(n=>{const s=n.map(o=>({...o,result:{type:"pending"}}));me("testResults",s),me("dbStatus",{type:"done"})}).catch(n=>{me("dbStatus",{type:"error",message:n.message})})};function pe(e){return nn(ae,me,e)}const ks=e=>{const t=Bt(e);return typeof t=="string"?"Error: "+t:`curl -H "Content-type:application/json" --data-raw '${JSON.stringify(t)}' ${ae.server}/move`},Ts=e=>JSON.stringify(e),Cs=async()=>{const e={id:ve(10),description:"new test",timestamp:Date.now(),frameToTest:0,snakeToTest:0,expectedResult:[],frames:[{turn:0,snakes:[],food:[],hazards:[]}],game:{id:"new game",timeout:500,width:11,height:11,ruleset:{name:"standard",version:"v.1.2.3"}}};return await _e(e),e},Rs=async()=>{const e=(await Mt(()=>import("./examples.d6107786.js"),[])).default;await Promise.all(e.map(t=>_e(t)))},Ls=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 448 512"><path d="M448 240v96c0 3.084-.356 6.159-1.063 9.162l-32 136C410.686 499.23 394.562 512 376 512H168a40.004 40.004 0 0 1-32.35-16.473l-127.997-176c-12.993-17.866-9.043-42.883 8.822-55.876c17.867-12.994 42.884-9.043 55.877 8.823L104 315.992V40c0-22.091 17.908-40 40-40s40 17.909 40 40v200h8v-40c0-22.091 17.908-40 40-40s40 17.909 40 40v40h8v-24c0-22.091 17.908-40 40-40s40 17.909 40 40v24h8c0-22.091 17.908-40 40-40s40 17.909 40 40zm-256 80h-8v96h8v-96zm88 0h-8v96h8v-96zm88 0h-8v96h8v-96z" fill="currentColor"/></svg>');var zs=(e={})=>{const t=Ls.cloneNode(!0);return X(t,e,!0),t};const Ns=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19.5 17H18c1.1 0 2-.9 2-2s-.9-2-2-2V9c0-1 0-2-1.08-2.86c.05-.21.08-.42.08-.64C17 3.57 15 2 12.5 2c-2.26 0-4.12 1.31-4.43 3H6L3.71 2.79L3 3.5l2 2l-2 2l.71.71L6 6h2.07c.31 1.69 2.17 3 4.43 3c.5 0 1-.08 1.43-.2c.04.07.07.14.07.2v4H8c-1.1 0-2 .9-2 2s.9 2 2 2H6.5A2.5 2.5 0 0 0 4 19.5c0 .17 0 .34.05.5H4c-1.1 0-2 .9-2 2h17.5a2.5 2.5 0 0 0 0-5M12 5c-.55 0-1-.45-1-1s.45-1 1-1s1 .45 1 1s-.45 1-1 1z" fill="currentColor"/></svg>');var Ms=(e={})=>{const t=Ns.cloneNode(!0);return X(t,e,!0),t};const As=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 48 48"><g fill="none"><path d="M20.3 30l-4.216 7.44a.64.64 0 0 0-.059.495a.662.662 0 0 0 .315.393c4.667 2.61 10.654 2.61 15.318 0a.661.661 0 0 0 .317-.393a.638.638 0 0 0-.06-.495L27.701 30a6.046 6.046 0 0 1-3.7 1.25A6.046 6.046 0 0 1 20.3 30z" fill="currentColor"/><path d="M20.85 17.724l-4.336-7.371a.64.64 0 0 0-.398-.299a.662.662 0 0 0-.499.077c-4.593 2.736-7.587 7.92-7.659 13.265a.661.661 0 0 0 .183.471c.12.125.284.195.458.196l8.55.07a6.047 6.047 0 0 1 .769-3.829a6.046 6.046 0 0 1 2.932-2.58z" fill="currentColor"/><path d="M30.85 24.275l8.551-.069a.64.64 0 0 0 .458-.196a.662.662 0 0 0 .183-.47c-.073-5.346-3.066-10.53-7.659-13.265a.662.662 0 0 0-.498-.078a.638.638 0 0 0-.4.299l-4.335 7.37a6.047 6.047 0 0 1 2.932 2.58c.7 1.211.938 2.559.768 3.83z" fill="currentColor"/><path d="M29 24a5 5 0 1 1-10 0a5 5 0 0 1 10 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M24 42c9.941 0 18-8.059 18-18S33.941 6 24 6S6 14.059 6 24s8.059 18 18 18zm0 2c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20z" fill="currentColor"/></g></svg>');var Bs=(e={})=>{const t=As.cloneNode(!0);return X(t,e,!0),t};const Es=b('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z" fill="currentColor"/></svg>');var Ds=(e={})=>{const t=Es.cloneNode(!0);return X(t,e,!0),t};const Os="_hideSpinner_drfhl_3";var Is={hideSpinner:Os};const Ps=b("<p>Drag the head or the tail of a snake to change its size.</p>"),Hs=b("<p>Add a new snake. Choose a style and then drag an empty cell.</p>"),js=b("<ul></ul>"),Fs=b("<p>Add hazards in row or column by clicking in a cell next to a wall or another hazards.</p>"),Ys=b("<p>Delete a snakes or food by clicking them</p>"),Gs=b('<div class="flex flex-col m-4 bg-white shadow"><h3 class="text-gray-500 text-xl p-6">Board builder</h3><div class="flex items-start flex-wrap p-6"><div class="inline-block"><div class="flex items-center mr-1"><button title="edit snake" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="new snake" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="add hazards" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="delete element" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div></div><table></table></div><div class="p-6"></div><div class="p-6"><button class="bg-blue-400 text-white px-2 font-bold rounded">Save</button></div></div>'),Us=b('<tr><td class="pr-2 py-1"></td><td class="text-right tabular-nums"></td><td></td><td class="text-right tabular-nums w-10"><input class="p-0 w-12 text-right focus:ring-0 border-none" type="number"></td><td></td></tr>'),Js=b('<li class="flex items-center my-2"><input type="radio" name="snakeStyle"><label class="ml-1" style="font-size:0"></label></li>'),Dt=[{head:"default",tail:"default",color:"#2563EB"},{head:"default",tail:"default",color:"#D97706"},{head:"default",tail:"default",color:"#EF4444"},{head:"default",tail:"default",color:"#10B981"}];function Vs(e){const[t,n]=K("pointer"),[s,o]=K(0),[r,l]=K({turn:0,snakes:[],food:[],hazards:[]}),[i,c]=K({id:"builder",timeout:500,width:11,height:11,ruleset:{name:"standard",version:"v.1.2.3"}}),_=e.testResult().id;e.readTest(_).then(y=>{const m=Te(y.game),S=Te(y.frames.find(I=>I.turn==y.frameToTest));S.snakes=S.snakes.filter(I=>!I.death),c(m),l(S)});let d={dragging:!1};const h=y=>{const m=+y.dataset.x,S=+y.dataset.y;return{x:m,y:S}},u=(y,m)=>Math.abs(y.x-m.x)+Math.abs(y.y-m.y),w=y=>r().food.some(m=>se(m,y)),z=y=>r().snakes.some(m=>m.body.some(S=>se(S,y))),T=y=>!w(y)&&!z(y),O=y=>r().hazards.some(m=>se(m,y)),W=y=>y.x<0||y.y<0||y.x>=i().width||y.y>=i().height,A=y=>W(y)||O(y),ee=y=>{y.addEventListener("mousedown",()=>{const m=h(y);if(t()=="add snake"){if(!T(m))return;const N=Dt[s()],P=ve(5),J={id:P,name:"snake "+P,url:"",body:[m],health:100,color:N.color,headType:N.head,tailType:N.tail,latency:"0",shout:"",squad:"",author:"board builder"};l({...r(),snakes:r().snakes.concat([J])}),n("pointer"),d={dragging:!0,snakeIdx:r().snakes.length-1,snakeHandler:"head"};return}if(t()=="hazards"){const N={x:m.x,y:m.y+1},P={x:m.x,y:m.y-1},J={x:m.x-1,y:m.y},$={x:m.x+1,y:m.y};if(O(m)){let f=r().hazards.slice();(!A(N)||!A(P))&&(f=f.filter(p=>p.y!=m.y||A({x:p.x,y:p.y+1})&&A({x:p.x,y:p.y-1}))),(!A(J)||!A($))&&(f=f.filter(p=>p.x!=m.x||A({x:p.x-1,y:p.y})&&A({x:p.x+1,y:p.y}))),f.length===i().height*i().width&&(f=f.filter(p=>!se(p,m))),l({...r(),hazards:f})}else{const f=r().hazards.slice();if(A(N)||A(P))for(let p=0,L=i().width;p<L;p++)f.push({x:p,y:m.y});if(A(J)||A($))for(let p=0,L=i().height;p<L;p++)f.push({x:m.x,y:p});l({...r(),hazards:Wt(f)})}return}if(t()=="delete"){if(w(m)){l({...r(),food:r().food.filter(P=>!se(P,m))});return}const N=r().snakes.findIndex(P=>P.body.find(J=>se(J,m)));N>=0&&l({...r(),snakes:[...r().snakes.slice(0,N),...r().snakes.slice(N+1)]});return}if(T(m)){l({...r(),food:[...r().food,m]});return}if(w(m)){l({...r(),food:r().food.filter(N=>!se(N,m))});return}const S=r().snakes.findIndex(N=>se(N.body[0],m));if(S>=0){d={dragging:!0,snakeIdx:S,snakeHandler:"head"};return}const I=r().snakes.findIndex(N=>se(N.body[N.body.length-1],m));I>=0&&(d={dragging:!0,snakeIdx:I,snakeHandler:"tail"})}),y.addEventListener("mouseenter",()=>{if(d.dragging){const m=h(y),S={...r().snakes[d.snakeIdx]};S.body=S.body.slice(),d.snakeHandler=="tail"&&S.body.reverse();const I=S.body[0];if(u(I,m)==1){S.body[1]&&se(m,S.body[1])?S.body.length>=2&&S.body.shift():T(m)&&S.body.unshift(m),d.snakeHandler=="tail"&&S.body.reverse();const N=r().snakes.slice();N[d.snakeIdx]=S,l({...r(),snakes:N})}else if(u(I,m)==2&&I.x!=m.x&&I.y!=m.y){if(S.body[2]&&se(m,S.body[2]))S.body.length>=3&&(S.body.shift(),S.body.shift());else{const P={x:I.x,y:m.y},J={x:m.x,y:I.y};T(P)&&T(m)?(S.body.unshift(P),S.body.unshift(m)):T(J)&&T(m)&&(S.body.unshift(J),S.body.unshift(m))}d.snakeHandler=="tail"&&S.body.reverse();const N=r().snakes.slice();N[d.snakeIdx]=S,l({...r(),snakes:N})}}}),window.addEventListener("mouseup",()=>{d.dragging=!1})},j=(y,m)=>{const S=y.target,I=S.value.trim()!=""?+S.value:0,N=Math.min(Math.max(0,I),100);S.value=S.value.trim()!=""?N.toString():"";const P=r().snakes.slice();P[m]={...P[m],health:N},l({...r(),snakes:P})};async function Y(){const y=await e.readTest(_),m=y.frames.length>1,S={id:m?ve(10):y.id,timestamp:Date.now(),description:m?"(truncated) "+y.description:y.description,game:i(),frames:[r()],frameToTest:r().turn,snakeToTest:y.snakeToTest<=r().snakes.length-1?y.snakeToTest:0,expectedResult:y.expectedResult};await e.saveTest(S),e.setView("test")}return(()=>{const y=Gs.cloneNode(!0),m=y.firstChild,S=m.nextSibling,I=S.firstChild,N=I.firstChild,P=N.firstChild,J=P.nextSibling,$=J.nextSibling,f=$.nextSibling,p=I.nextSibling,L=S.nextSibling,V=L.nextSibling,Q=V.firstChild;return g(I,a(Ct,{get frame(){return r()},get game(){return i()},ref(R){const B=ee;typeof B=="function"?B(R):ee=R},class:"cursor-pointer"}),N),P.$$click=()=>n("pointer"),g(P,a(zs,{})),J.$$click=()=>n("add snake"),g(J,a(Ms,{})),$.$$click=()=>n("hazards"),g($,a(Bs,{})),f.$$click=()=>n("delete"),g(f,a(Ds,{})),g(p,a(Xt,{get each(){return r().snakes},children:(R,B)=>(()=>{const M=Us.cloneNode(!0),E=M.firstChild,F=E.nextSibling,D=F.nextSibling,te=D.nextSibling,q=te.firstChild,ce=te.nextSibling;return E.style.setProperty("font-size",0),g(E,a(ze,{get color(){return R().color},get head(){return R().headType},get tail(){return R().tailType}})),g(F,()=>R().body.length),g(D,a(mt,{class:"text-gray-500"})),q.$$input=G=>j(G,B),g(ce,a(pt,{class:"text-red-500"})),U(G=>{const re={[Is.hideSpinner]:!0},ne=R().health;return G._v$5=Oe(q,re,G._v$5),ne!==G._v$6&&(q.value=G._v$6=ne),G},{_v$5:void 0,_v$6:void 0}),M})()})),g(L,a(we,{get children(){return[a(Z,{get when(){return t()=="pointer"},get children(){return Ps.cloneNode(!0)}}),a(Z,{get when(){return t()=="add snake"},get children(){return[Hs.cloneNode(!0),(()=>{const R=js.cloneNode(!0);return g(R,a(ye,{each:Dt,children:(B,M)=>(()=>{const E=Js.cloneNode(!0),F=E.firstChild,D=F.nextSibling;return F.$$input=()=>o(M()),g(D,a(ze,{get head(){return B.head},get tail(){return B.tail},get color(){return B.color}})),U(()=>F.checked=M()==0),E})()})),R})()]}}),a(Z,{get when(){return t()=="hazards"},get children(){return Fs.cloneNode(!0)}}),a(Z,{get when(){return t()=="delete"},get children(){return Ys.cloneNode(!0)}})]}})),Q.$$click=()=>Y(),U(R=>{const B=t()=="pointer",M=t()=="add snake",E=t()=="hazards",F=t()=="delete";return B!==R._v$&&P.classList.toggle("border-gray-300",R._v$=B),M!==R._v$2&&J.classList.toggle("border-gray-300",R._v$2=M),E!==R._v$3&&$.classList.toggle("border-gray-300",R._v$3=E),F!==R._v$4&&f.classList.toggle("border-gray-300",R._v$4=F),R},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),y})()}ge(["click","input"]);const qs=b('<div class="flex flex-col h-screen min-w-max"><header><div class="p-4" style="background-color:#72268c;"><h1 class="text-center text-white text-2xl font-semibold tracking-wide">Battlesnake Tester</h1></div><div class="p-4 bg-white" style="box-shadow:0 1px 1px 1px rgb(18 106 211 / 8%);"></div></header><div class="flex flex-1 flex-row mt-1 overflow-hidden"><aside class="flex bg-white w-80 p-4 shadow"></aside><main class="flex flex-1 flex-col p-4 overflow-y-auto"><div class="flex"></div><div class="flex flex-1 items-end"><a class="m-4 text-gray-500 hover:text-blue-400 text-sm" target="_blank" href="https://play.battlesnake.com/">Assets used with permission from Battlesnake</a></div></main></div></div>'),Xs=()=>{const[e,t]=pe("server"),[n,s]=pe("view"),[o,r]=pe("testResults"),[l,i]=pe("testedSnake.style"),[c]=pe("dbStatus"),v=pe("selected"),[_,d]=K(!0),h=w=>{s(w),d(!_())};function u(w){return fe(Kt(w.on,()=>w.children))}return(()=>{const w=qs.cloneNode(!0),z=w.firstChild,T=z.firstChild,O=T.firstChild,W=T.nextSibling,A=z.nextSibling,ee=A.firstChild,j=ee.nextSibling,Y=j.firstChild;return O.$$click=()=>h("home"),g(W,a(yn,{server:[e,t],style:[l,i],setView:h,get createEmptyTest(){return Cs}})),g(ee,a(cs,{get runAllTests(){return ys},selected:v,setView:h,testResults:o,get importExamples(){return Rs},dbStatus:c})),g(Y,a(we,{get children(){return[a(Z,{get when(){return n()=="home"},get children(){return a(us,{})}}),(()=>{const y=ke(()=>n()=="test",!0);return a(Z,{get when(){return y()&&Ee()},get children(){return a(Qr,{mySnakeStyle:l,get testResult(){return Ee},get runSingleTest(){return ws},get runUnsavedTest(){return xs},get readTest(){return Et},get deleteTest(){return $s},get saveTest(){return _e},get asCurl(){return ks},get asJson(){return Ts},setView:h})}})})(),a(Z,{get when(){return n()=="importer"},get children(){return a(u,{on:_,get children(){return a(En,{server:e,get saveTest(){return _e},setView:h})}})}}),a(Z,{get when(){return n()=="exportimportdb"},get children(){return a(hs,{get exportToJson(){return _s},get importFromJson(){return Ss}})}}),(()=>{const y=ke(()=>n()=="builder",!0);return a(Z,{get when(){return y()&&Ee()},get children(){return a(u,{on:_,get children(){return a(Vs,{get testResult(){return Ee},get readTest(){return Et},get saveTest(){return _e},setView:h})}})}})})()]}})),w})()};ge(["click"]);const Ot=document.getElementById("root");Ot&&Zt(()=>a(Xs,{}),Ot);

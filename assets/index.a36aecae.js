import{t as m,s as V,c as J,i as g,a,b as jt,d as R,h as at,e as ct,f as De,g as Oe,S as le,j as ge,k as ve,l as G,M as q,m as pe,n as he,o as T,p as Ft,q as Ie,r as xe,u as fe,v as Te,F as $e,w as Yt,x as Gt,P as Vt,z as Jt,y as dt,A as ut,B as Ce,C as qt,D as Wt,E as Xt,G as gt,I as Kt,H as oe,J as Zt,K as Qt,L as en}from"./vendor.420f2ab7.js";const tn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerpolicy&&(r.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?r.credentials="include":l.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}};tn();const nn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></g></svg>');var ht=(e={})=>{const t=nn.cloneNode(!0);return V(t,e,!0),t};function ye(e,t){const n=t();J(()=>e.value=n.get()||""),e.addEventListener(n.updateOn,s=>n.set(s.target.value))}const ft=(e,t)=>({get:e,set:t,updateOn:"input"}),Pe=(e,t)=>({get:e,set:t,updateOn:"blur"});function rn(e){let t=e.value;e.addEventListener("input",()=>{t.length>e.value.length&&(e.style.width="0"),e.style.width=`${e.scrollWidth}px`,t=e.value})}function sn(e,t,n){const s=n.split(".");return[()=>{let o=e;for(let i=0;i<s.length;i++)if(o=o[s[i]],o==null){if(i!==s.length-1)return;break}return o},o=>t.call(null,...s,o)]}const ln=m("<svg><g><image></image></g></svg>",6,!0),on=m('<svg><filter><feColorMatrix color-interpolation-filters="sRGB" type="matrix" result="colormatrix"></feColorMatrix></filter></svg>',6,!0),He={head:{},tail:{}},an=e=>e.replace(/^bwc-/,"").replace(/^shac-/,"");async function Re(e,t){if(t=an(t),He[e][t])return He[e][t];const n=await fetch(`assets/${e}s/${t}.png`).then(s=>s.ok?s.blob():fetch(`assets/${e}s/default.png`).then(l=>l.blob())).then(s=>{const l=URL.createObjectURL(s);return r=>(()=>{const o=ln.cloneNode(!0),i=o.firstChild;return g(o,a(cn,{get color(){return r.fill}}),i),jt(i,"http://www.w3.org/1999/xlink","xlink:href",l),V(i,r,!0,!1),J(()=>R(i,"filter",`url(#${mt(r.fill)}`)),o})()});return He[e][t]=n,n}function mt(e){const t=at(e);return"color"+t.red.toString(16).padStart(2,"0")+t.green.toString(16).padStart(2,"0")+t.blue.toString(16).padStart(2,"0")}function cn(e){const t=at(e.color),n=mt(e.color);return(()=>{const s=on.cloneNode(!0),l=s.firstChild;return R(s,"id",n),J(()=>R(l,"values",`0 0 0 0 ${t.red/255}
                 0 0 0 0 ${t.green/255}
                 0 0 0 0 ${t.blue/255}
                 0 0 0 1 0`)),s})()}const dn="_snake_pfrd6_1",un="_head_pfrd6_6",gn="_body_pfrd6_12",hn="_tail_pfrd6_18";var Le={snake:dn,head:un,body:gn,tail:hn};const fn=m('<div><span><svg viewBox="0 0 100 100" width="20" height="20"></svg></span><span></span><span><svg viewBox="0 0 100 100" width="20" height="20"></svg></span></div>'),Ne=e=>{const[t,n]=ct(e,["color","head","tail"]),s=async()=>{const r=await Re("head",e.head),o=await Re("tail",e.tail);return{Head:r,Tail:o}},[l]=De(s);return a(le,{get when(){return l()},children:({Head:r,Tail:o})=>(()=>{const i=fn.cloneNode(!0),c=i.firstChild,v=c.firstChild,y=c.nextSibling,d=y.nextSibling,f=d.firstChild;return V(i,n,!1,!0),g(v,a(o,{get fill(){return e.color}})),g(f,a(r,{get fill(){return e.color}})),J(u=>{const h={flex:!0,[Le.snake]:!0},C=Le.tail,_=Le.body,A=e.color,j=Le.head;return u._v$=Oe(i,h,u._v$),C!==u._v$2&&(c.className=u._v$2=C),_!==u._v$3&&(y.className=u._v$3=_),A!==u._v$4&&y.style.setProperty("background-color",u._v$4=A),j!==u._v$5&&(d.className=u._v$5=j),u},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),i})()})},mn=m("<span>loading...</span>"),vn=m('<div class="fixed inset-0 h-full w-full z-10"></div>'),pn=m('<div class="absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-md z-20 border border-gray-100"><button class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-yellow-100">Export/Import DB</button></div>'),xn=m('<div class="flex items-center"><div style="min-width:308px"><span class="font-bold text-gray-500">Server:</span><input class="ml-1 px-3 rounded bg-gray-100 text-gray-700 round min-w-44 w-0"></div><button class="bg-blue-400 text-white ml-8 px-2 font-bold rounded">New test</button><button class="bg-blue-400 text-white ml-8 px-2 font-bold rounded">Board builder</button><div class="flex-1 flex justify-end"><div class="relative"><button class="relative block rounded-md bg-white p-2 ml-1 border border-white hover:border-gray-200 focus:outline-none"></button></div></div></div>'),$n=m('<span class="text-red-400 font-bold">Error: </span>'),bn=m('<button class="border border-gray-400 rounded text-xs px-2 ml-3 text-gray-600">retry</button>'),wn=async e=>fetch(e).then(t=>t.json()).catch(t=>{const n=t;return fetch(e,{mode:"no-cors"}).then(s=>{throw new Error("your server hasn't enabled CORS")},s=>{throw n})});function yn(e){const[t,n]=e.server,[s,l]=e.style,r=async f=>{const u=await wn(f);T(u,T.object.partialShape({color:T.string,head:T.string,tail:T.string}));const{color:h,head:C,tail:_}=u;return{color:h,headType:C,tailType:_}},[o,{refetch:i}]=De(t,r);ve(()=>l(o.loading||o.error?void 0:o()));const c=async()=>{await e.createEmptyTest(),e.setView("builder")},[v,y]=G(!1),d=(f,...u)=>()=>{y(!1),f(...u)};return(()=>{const f=xn.cloneNode(!0),u=f.firstChild,h=u.firstChild,C=h.nextSibling,_=u.nextSibling,A=_.nextSibling,j=A.nextSibling,z=j.firstChild,ee=z.firstChild;return ye(C,()=>Pe(t,n)),rn(C),g(u,a(pe,{get children(){return[a(q,{get when(){return o.loading},get children(){return mn.cloneNode(!0)}}),a(q,{get when(){return o.error},children:F=>[(()=>{const P=$n.cloneNode(!0);return P.firstChild,g(P,()=>F.message,null),P})(),(()=>{const P=bn.cloneNode(!0);return P.$$click=()=>i(),P})()]}),a(q,{get when(){return s()},children:F=>a(Ne,{class:"mx-2",get color(){return F.color},get head(){return F.headType},get tail(){return F.tailType}})})]}}),null),_.$$click=()=>e.setView("importer"),A.$$click=c,ee.$$click=()=>y(!v()),g(ee,a(ht,{class:"text-gray-500"})),g(z,a(le,{get when(){return v()},get children(){return[(()=>{const F=vn.cloneNode(!0);return F.$$click=()=>y(!1),F})(),(()=>{const F=pn.cloneNode(!0),P=F.firstChild;return he(P,"click",d(e.setView,"exportimportdb"),!0),F})()]}}),null),f})()}ge(["click"]);function _n(e){return Tn(e),{turn:e.Turn,snakes:e.Snakes.map(Sn),food:e.Food.map(Ue),hazards:e.Hazards.map(Ue)}}function Sn(e){return{id:e.ID,name:e.Name,body:e.Body.map(Ue),color:e.Color,health:e.Health,latency:e.Latency,death:kn(e.Death),headType:e.HeadType&&e.HeadType.toLowerCase()||"default",tailType:e.TailType&&e.TailType.toLowerCase()||"default",squad:e.Squad,author:e.Author,shout:e.Shout,url:e.URL}}function kn(e){if(e)return{cause:e.Cause,turn:e.Turn||0,eliminatedBy:e.EliminatedBy}}function Ue(e){return{x:e.X,y:e.Y}}function Tn(e){e.Turn=e.Turn||0;for(const t of e.Snakes)for(const n of t.Body)n.X=n.X||0,n.Y=n.Y||0;for(const t of e.Food)t.X=t.X||0,t.Y=t.Y||0}const Cn="v.1.2.3";async function Rn(e){const t=await fetch(e);return t.status===200?Promise.resolve(t.json()):Promise.resolve(t.json()).then(n=>(console.error(n.error),Promise.reject(n.error)))}async function vt(e){const t=`https://engine.battlesnake.com/games/${e}`,n=await Rn(t),s={id:n.Game.ID,ruleset:{name:n.Game.Ruleset.name,version:Cn},width:n.Game.Width,height:n.Game.Height,timeout:n.Game.SnakeTimeout},l=`wss://engine.battlesnake.com/socket/${e}`,r=await Ln(l,_n);return{game:s,frames:r}}function Ln(e,t){const n=new Map;return new Promise((s,l)=>{const r=new WebSocket(e);r.addEventListener("message",({data:o})=>{try{const i=JSON.parse(o),c=t(i);n.set(c.turn.toString(),c)}catch(i){l(i)}}),r.addEventListener("close",function(){const i=Ft((y,d)=>y.turn-d.turn,[...n.values()]),c=i.length-1;i[c].turn!==c?l(new Error("missing some frames")):s(i)})})}const Nn=T.object.exactShape({id:T.string,ruleset:{name:T.string,version:T.string},timeout:T.number,width:T.number,height:T.number}),je=T.object.exactShape({x:T.number,y:T.number}),zn=T.object.exactShape({cause:T.string,turn:T.number,eliminatedBy:T.string}),Mn=T.object.exactShape({id:T.string,name:T.string,url:T.string,body:T.array.ofType(je),health:T.number,death:T.any(zn,T.undefined),color:T.string,headType:T.string,tailType:T.string,latency:T.string,shout:T.string,squad:T.string,author:T.string}),An=T.object.exactShape({turn:T.number,snakes:T.array.ofType(Mn),food:T.array.ofType(je),hazards:T.array.ofType(je)}),Bn=T.string.oneOf(["Up","Down","Left","Right"]),pt=T.object.exactShape({id:T.string,description:T.string,timestamp:T.number,game:Nn,frames:T.array.ofType(An),frameToTest:T.number,snakeToTest:T.number,expectedResult:T.array.ofType(Bn)}),En=m('<div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">Create test from game</h3><div class="flex my-4"><div class="space-y-2"><div><span>Game ID or URL:</span><input class="py-0 rounded border-gray-400 mx-2 w-84 inline-block" type="text"><p></p></div></div></div></div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">Import from Json</h3><div class="flex my-4"><div class="space-y-2"><div><p> If you have a previouly exported test as Json, you can import it pasting the source here:</p><textarea class="rounded border-gray-400 mt-2 w-full inline-block"></textarea><p class="text-red-500"></p></div></div></div></div></div>'),xt=/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/;function Dn(e){const[t,n]=G(""),[s,l]=G(""),r=async()=>{l("importing...");const f=await vt(t()).catch(u=>{throw l(u),u});e.createTest(f.game,f.frames),e.setView("test")},o=f=>{const u=xt.exec(f);return u?u[0]:f};ve(()=>{xt.exec(t())&&r()});let i;Ie(()=>i?.focus());const[c,v]=G(""),[y,d]=G();return ve(async()=>{d();const f=c();if(f)try{const u=JSON.parse(f);T(u,pt);const h=u;h.id=xe(10),h.timestamp=Date.now(),await e.saveTest(h),e.setView("test")}catch(u){d(u.message)}}),(()=>{const f=En.cloneNode(!0),u=f.firstChild,h=u.firstChild,C=h.nextSibling,_=C.firstChild,A=_.firstChild,j=A.firstChild,z=j.nextSibling,ee=z.nextSibling,F=u.nextSibling,P=F.firstChild,b=P.nextSibling,x=b.firstChild,w=x.firstChild,E=w.firstChild,M=E.nextSibling,H=M.nextSibling;ye(z,()=>ft(t,k=>n(o(k))));const X=i;return typeof X=="function"?X(z):i=z,g(ee,s),ye(M,()=>ft(c,v)),g(H,y),f})()}const On=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path d="M5.52.359A.5.5 0 0 1 6 0h4a.5.5 0 0 1 .474.658L8.694 6H12.5a.5.5 0 0 1 .395.807l-7 9a.5.5 0 0 1-.873-.454L6.823 9.5H3.5a.5.5 0 0 1-.48-.641l2.5-8.5zM6.374 1L4.168 8.5H7.5a.5.5 0 0 1 .478.647L6.78 13.04L11.478 7H8a.5.5 0 0 1-.474-.658L9.306 1H6.374z"/></g></svg>');var In=(e={})=>{const t=On.cloneNode(!0);return V(t,e,!0),t};const Pn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 21a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zm-3.25-1.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0zm-3-12.75a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zM2.5 4.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0zM18.25 6.5a1.75 1.75 0 1 1 0-3.5a1.75 1.75 0 0 1 0 3.5zM15 4.75a3.25 3.25 0 1 0 6.5 0a3.25 3.25 0 0 0-6.5 0z" fill="currentColor"/><path fill-rule="evenodd" d="M6.5 7.75v1A2.25 2.25 0 0 0 8.75 11h6.5a2.25 2.25 0 0 0 2.25-2.25v-1H19v1a3.75 3.75 0 0 1-3.75 3.75h-6.5A3.75 3.75 0 0 1 5 8.75v-1h1.5z" fill="currentColor"/><path fill-rule="evenodd" d="M11.25 16.25v-5h1.5v5h-1.5z" fill="currentColor"/></svg>');var Hn=(e={})=>{const t=Pn.cloneNode(!0);return V(t,e,!0),t};const Un=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 6 16"><path fill-rule="evenodd" d="M0 14l6-6l-6-6v12z" fill="currentColor"/></svg>');var jn=(e={})=>{const t=Un.cloneNode(!0);return V(t,e,!0),t};const Fn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 1200 1200"><path d="M304.102 295.898L0 600l304.102 304.102v-203.54h591.797v203.539L1200 600L895.898 295.898v203.539H304.102V295.898z" fill="currentColor"/></svg>');var $t=(e={})=>{const t=Fn.cloneNode(!0);return V(t,e,!0),t};const Yn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 36 36"><path d="M33 7.64c-1.34-2.75-5.2-5-9.69-3.69A9.87 9.87 0 0 0 18 7.72a9.87 9.87 0 0 0-5.31-3.77C8.19 2.66 4.34 4.89 3 7.64c-1.88 3.85-1.1 8.18 2.32 12.87C8 24.18 11.83 27.9 17.39 32.22a1 1 0 0 0 1.23 0c5.55-4.31 9.39-8 12.07-11.71c3.41-4.69 4.19-9.02 2.31-12.87z" class="clr-i-solid clr-i-solid-path-1" fill="currentColor"/></svg>');var bt=(e={})=>{const t=Yn.cloneNode(!0);return V(t,e,!0),t};const Gn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M12 3.172L5.586 9.586a2 2 0 1 0 2.828 2.828L10 10.828v7.242a2 2 0 0 0 4 0v-7.242l1.586 1.586c.391.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L12 3.172z" fill="currentColor"/></svg>');var Fe=(e={})=>{const t=Gn.cloneNode(!0);return V(t,e,!0),t};const Vn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18.414 10.656a2 2 0 0 0-2.828 0L14 12.242V5a2 2 0 0 0-4 0v7.242l-1.586-1.586a2 2 0 1 0-2.828 2.828L12 19.898l6.414-6.414a2 2 0 0 0 0-2.828z" fill="currentColor"/></svg>');var Ye=(e={})=>{const t=Vn.cloneNode(!0);return V(t,e,!0),t};const Jn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M18 11h-7.244l1.586-1.586a2 2 0 1 0-2.828-2.828L3.1 13l6.414 6.414c.39.391.902.586 1.414.586s1.023-.195 1.414-.586a2 2 0 0 0 0-2.828L10.756 15H18a2 2 0 0 0 0-4z" fill="currentColor"/></svg>');var Ge=(e={})=>{const t=Jn.cloneNode(!0);return V(t,e,!0),t};const qn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M10.586 6.586a2 2 0 0 0 0 2.828L12.172 11H4.928a2 2 0 0 0 0 4h7.244l-1.586 1.586a2 2 0 1 0 2.828 2.828L19.828 13l-6.414-6.414a2 2 0 0 0-2.828 0z" fill="currentColor"/></svg>');var Ve=(e={})=>{const t=qn.cloneNode(!0);return V(t,e,!0),t};const Wn=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/></g></svg>');var Xn=(e={})=>{const t=Wn.cloneNode(!0);return V(t,e,!0),t};const _e={pageBackground:"transparent",gridDot:"#6a208f",gridCellBackground:"#f1f1f1",gridCellBackgroundDark:"#D6D5EA",food:"#ff5c75",hazard:"#000000",hazardOpacity:"0.4",overlapSnake:"#AAAAAA",healthBar:"#0f0",healthBarBackground:"#fefefe",healthBarOutline:"#666",healthBarDeathBackground:"#f1f1f1",healthBarDeathBackgroundDark:"#59526b",lightText:"#efefef",darkText:"#222",blue:"#007bff",indigo:"#6610f2",purple:"#6f42c1",pink:"#e83e8c",red:"#dc3545",orange:"#fd7e14",yellow:"#ffc107",green:"#28a745",teal:"#20c997",cyan:"#17a2b8",white:"#fff",gray:"#6c757d",grayLight:"#f1f1f1",grayDark:"#343a40",primary:"#007bff",secondary:"#6c757d",success:"#28a745",info:"#17a2b8",warning:"#ffc107",danger:"#dc3545",light:"#f8f9fa",dark:"#343a40"},Kn=m("<svg></svg>"),Zn=m("<svg><rect></rect></svg>",4,!0);function wt(e){const t=[];for(let n=0;n<e;n++)t.push(n);return t}function Qn(e){const t=e.ctx,n=(t.cellSize+t.cellSpacing)*t.gameWidth+t.cellSpacing,s=(t.cellSize+t.cellSpacing)*t.gameHeight+t.cellSpacing;return(()=>{const l=Kn.cloneNode(!0);return R(l,"viewBox",`0 0 ${n} ${s}`),g(l,()=>wt(t.gameHeight).map((r,o)=>wt(t.gameWidth).map((i,c)=>(()=>{const v=Zn.cloneNode(!0),y=e.ref;return typeof y=="function"?y(v):e.ref=v,R(v,"data-x",c),R(v,"data-y",o),J(d=>{const f=t.toGridSpaceX(c),u=t.toGridSpaceY(o),h=t.cellSize,C=t.cellSize,_=_e.gridCellBackground;return f!==d._v$&&R(v,"x",d._v$=f),u!==d._v$2&&R(v,"y",d._v$2=u),h!==d._v$3&&R(v,"width",d._v$3=h),C!==d._v$4&&R(v,"height",d._v$4=C),_!==d._v$5&&R(v,"fill",d._v$5=_),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),v})())),null),g(l,()=>e.children,null),l})()}let S;(function(e){e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"})(S||(S={}));function ze(e){return{type:"ok",value:e}}function yt(e){return{type:"error",msg:e}}const er=S.Up;async function tr(e){const t=Re("head",e.headType),n=Re("tail",e.tailType),s=e.body.filter((l,r)=>_t(e,r));return Object.assign({},e,{parts:e.body.map((l,r)=>nr(e,r)),effectiveSpace:s.length,headSvg:await t,tailSvg:await n})}function nr(e,t){const n=e.body[t],s=sr(e,t),{x:l,y:r}=n,o=rr(s,e,n,t),i=_t(e,t)?void 0:!0;return{direction:o,type:s,isOverlapped:i,x:l,y:r,shadeForOverlap:!1}}function _t(e,t){const n=0,s=e.body.length-1,l=e.body[n],r=e.body[s],o=e.body[t];if(t===n)return!0;if(t===s)return!(l.x===o.x&&l.y===o.y);const i=e.body[t-1];return!(r.x===o.x&&r.y===o.y)&&!(l.x===o.x&&l.y===o.y)&&!(i&&i.x===o.x&&i.y===o.y)}function rr(e,t,n,s){let l;if(t.body.length==1)l=S.Up;else if(e===ie.HEAD)l=St(t.body[1],t.body[0]);else{let r;do r=t.body[Math.max(s-1,0)],--s;while(s>0&&r.x===n.x&&r.y===n.y);l=St(n,r)}return l}function St(e,t){return e.x<t.x?S.Right:e.x>t.x?S.Left:e.y>t.y?S.Down:e.y<t.y?S.Up:er}let ie;(function(e){e[e.HEAD=0]="HEAD",e[e.TAIL=1]="TAIL",e[e.BODY=2]="BODY"})(ie||(ie={}));function sr(e,t){return t===0?ie.HEAD:t===e.body.length-1?ie.TAIL:ie.BODY}const lr=m("<svg><g></g></svg>",4,!0),kt=m("<svg><rect></rect></svg>",4,!0),or=m("<svg><path></path></svg>"),ir=m('<svg><g class="pointer-events-none"></g></svg>',4,!0),ar=.1,cr=.3,dr=.8,ur=1,Tt=[S.Up,S.Right,S.Down,S.Left];var ae;(function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomRight=2]="BottomRight",e[e.BottomLeft=3]="BottomLeft"})(ae||(ae={}));function gr(e,t){const n=e.direction===S.Left||e.direction===S.Right?2*t.cellSpacing:0;return t.cellSize+n}function hr(e,t){const n=e.direction===S.Up||e.direction===S.Down?2*t.cellSpacing:0;return t.cellSize+n}function fr(e,t){const n=e.direction===S.Left||e.direction===S.Right?-t.cellSpacing:0;return t.toGridSpaceX(e.x)+n}function mr(e,t){const n=e.direction===S.Up||e.direction===S.Down?-t.cellSpacing:0;return t.toGridSpaceY(e.y)+n}function vr(e,t){return t.toGridSpaceX(e.x)-t.cellSpacing}function pr(e,t){return t.toGridSpaceY(e.y)-t.cellSpacing}function xr(e,t){switch(e.direction){case S.Left:return t.toGridSpaceX(e.x+1)-t.cellSpacing;case S.Right:return t.toGridSpaceX(e.x)-t.cellSpacing;default:return t.toGridSpaceX(e.x)}}function $r(e,t){switch(e.direction){case S.Up:return t.toGridSpaceY(e.y-1)-t.cellSpacing;case S.Down:return t.toGridSpaceY(e.y)-t.cellSpacing;default:return t.toGridSpaceY(e.y)}}function br(e,t){return e.direction===S.Left||e.direction===S.Right?t.cellSpacing:t.cellSize}function wr(e,t){return e.direction===S.Left||e.direction===S.Right?t.cellSize:t.cellSpacing}function Me(e){return!!e.death}function yr(e){return Me(e)?ar:1}function Ae(e){return e.shadeForOverlap?dr:e.isOverlapped?cr:ur}function Be(e,t){return t.shadeForOverlap?_e.overlapSnake:e.color}function _r(e){return e.concat().sort((t,n)=>{const s=Me(t)?0:1,l=Me(n)?0:1;return s-l})}function Ct(e,t){switch(e){case S.Left:return`scale(1,-1) rotate(180) translate(-${t} 0)`;case S.Up:return`rotate(270) translate(-${t} 0)`;case S.Down:return`rotate(90) translate(-${t} 0)`;default:return`translate(-${t} 0)`}}function Rt(e,t){switch(e){case S.Right:return`rotate(180) translate(-${t} 0)`;case S.Down:return`rotate(270) translate(-${t} 0)`;case S.Up:return`rotate(90) translate(-${t} 0)`;default:return`translate(-${t} 0)`}}function Sr(e,t){return Math.abs(Tt.indexOf(e)-Tt.indexOf(t))%2==1}function kr(e,t){if(t===0||t===e.parts.length-1)return!1;const n=e.parts[t+1],s=e.parts[t];return n.x===s.x&&n.y===s.y?!1:Sr(s.direction,n.direction)}function Tr(e,t){if(e.parts[t].type!=ie.BODY)throw new Error("do not call determineCornerType on a non body part");const n=e.parts[t].direction,s=e.parts[t+1].direction;if(n==S.Up&&s==S.Right||n==S.Left&&s==S.Down)return ae.TopLeft;if(n==S.Up&&s==S.Left||n==S.Right&&s==S.Down)return ae.TopRight;if(n==S.Down&&s==S.Left||n==S.Right&&s==S.Up)return ae.BottomRight;if(n==S.Down&&s==S.Right||n==S.Left&&s==S.Up)return ae.BottomLeft;throw new Error("unreachable")}function Lt(e,t){const n=e.body[e.body.length-1];return t.isOverlapped&&n.x===t.x&&n.y===t.y}function Cr(e,t,n,s,l){if(!Lt(e,n))switch(n.type){case ie.HEAD:return Rr(e,t,n,l);case ie.TAIL:return zr(e,t,n,l);case ie.BODY:return kr(e,s)?Nr(e,t,n,s,l):Lr(e,t,n,s,l)}}function Rr(e,t,n,s){const l=s.toGridSpaceX(n.x),r=s.toGridSpaceY(n.y),o=e.headSvg,i=Ct(n.direction,0),c=Be(e,n),v=Ae(n),y=d=>{d.setAttribute("transform",i),Ie(()=>{const f=d.getBoundingClientRect(),u=1*(100/f.width);d.setAttribute("transform",Ct(n.direction,u))})};return(()=>{const d=lr.cloneNode(!0);return g(d,a(o,{x:l,y:r,get width(){return s.cellSize},get height(){return s.cellSize},opacity:v,"transform-origin":"center",style:"transform-box: fill-box",fill:c,ref(f){const u=y;typeof u=="function"?u(f):y=f}}),null),g(d,(()=>{const f=Te(()=>e.effectiveSpace>1,!0);return()=>f()&&(()=>{const u=kt.cloneNode(!0);return R(u,"fill",c),R(u,"opacity",v),J(h=>{const C=xr(n,s),_=$r(n,s),A=br(n,s),j=wr(n,s);return C!==h._v$&&R(u,"x",h._v$=C),_!==h._v$2&&R(u,"y",h._v$2=_),A!==h._v$3&&R(u,"width",h._v$3=A),j!==h._v$4&&R(u,"height",h._v$4=j),h},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),u})()})(),null),d})()}function Lr(e,t,n,s,l){const r=Be(e,n),o=Ae(n);return(()=>{const i=kt.cloneNode(!0);return R(i,"fill",r),R(i,"opacity",o),J(c=>{const v=fr(n,l),y=mr(n,l),d=gr(n,l),f=hr(n,l);return v!==c._v$5&&R(i,"x",c._v$5=v),y!==c._v$6&&R(i,"y",c._v$6=y),d!==c._v$7&&R(i,"width",c._v$7=d),f!==c._v$8&&R(i,"height",c._v$8=f),c},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0}),i})()}function Nr(e,t,n,s,l){const r="M0,20 h60 a60,60 0 0 1 60,60 v60 h-100 v-20 h-20 z",o=Be(e,n),i=Ae(n),c="0 0 140 140";let v;switch(Tr(e,s)){case ae.BottomRight:v="rotate(270, 70, 70)";break;case ae.TopLeft:v="rotate(90, 70, 70)";break;case ae.BottomLeft:break;case ae.TopRight:v="rotate(180, 70, 70)";break}return(()=>{const d=or.cloneNode(!0),f=d.firstChild;return R(d,"fill",o),R(d,"opacity",i),R(d,"viewBox",c),R(f,"d",r),R(f,"transform",v),J(u=>{const h=vr(n,l),C=pr(n,l),_=l.cellSize+2*l.cellSpacing,A=l.cellSize+2*l.cellSpacing;return h!==u._v$9&&R(d,"x",u._v$9=h),C!==u._v$10&&R(d,"y",u._v$10=C),_!==u._v$11&&R(d,"width",u._v$11=_),A!==u._v$12&&R(d,"height",u._v$12=A),u},{_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0}),d})()}function zr(e,t,n,s){const l=s.toGridSpaceX(n.x),r=s.toGridSpaceY(n.y),o=e.tailSvg,i=Rt(n.direction,0),c=Be(e,n),v=Ae(n),y=d=>{d.setAttribute("transform",i),Ie(()=>{const f=d.getBoundingClientRect(),u=1*(100/f.width);d.setAttribute("transform",Rt(n.direction,u))})};return a(o,{x:l,y:r,get width(){return s.cellSize},get height(){return s.cellSize},opacity:v,"transform-origin":"center",style:"transform-box: fill-box",fill:c,ref(d){const f=y;typeof f=="function"?f(d):y=d}})}async function Mr(e,t){const n=await Promise.all(_r(t).map(l=>tr(l))),s=Array(e.gameHeight);for(let l=0;l<s.length;l++){s[l]=Array(e.gameWidth);for(let r=0;r<e.gameWidth;r++)s[l][r]=!1}for(let l=0;l<n.length;l++){const r=n[l];if(!Me(r))for(let o=0;o<r.parts.length;o++){const i=r.parts[o];Lt(r,i)||(s[i.y][i.x]?i.shadeForOverlap=!0:s[i.y][i.x]=!0)}}return n}function Ar(e){const t=e.ctx,n=fe(()=>e.frame.snakes||[]),[s]=De(n,l=>Mr(t,l));return a(le,{get when(){return!s.loading},get children(){return s().map((l,r)=>(()=>{const o=ir.cloneNode(!0);return g(o,()=>[...l.parts].reverse().map((i,c)=>Cr(l,r,i,l.parts.length-c-1,t))),J(()=>R(o,"opacity",yr(l))),o})())}})}const Br=m('<svg><circle class="pointer-events-none"></circle></svg>',4,!0);function Er(e){const t=e.ctx,n=(t.cellSize/3.25).toFixed(2),s=fe(()=>e.frame.food||[]);return a($e,{get each(){return s()},children:l=>(()=>{const r=Br.cloneNode(!0);return R(r,"r",n),J(o=>{const i=t.toGridSpaceX(l.x)+t.cellSize/2,c=t.toGridSpaceY(l.y)+t.cellSize/2,v=_e.food;return i!==o._v$&&R(r,"cx",o._v$=i),c!==o._v$2&&R(r,"cy",o._v$2=c),v!==o._v$3&&R(r,"fill",o._v$3=v),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),r})()})}const Dr=m('<svg><rect class="pointer-events-none"></rect></svg>',4,!0),Or=parseFloat(_e.hazardOpacity);function Ir(e){const t=e.ctx,n=fe(()=>e.frame.hazards||[]);return a($e,{get each(){return n()},children:s=>(()=>{const l=Dr.cloneNode(!0);return R(l,"fill-opacity",Or),J(r=>{const o=t.toGridSpaceX(s.x),i=t.toGridSpaceY(s.y),c=t.cellSize,v=t.cellSize,y=_e.hazard;return o!==r._v$&&R(l,"x",r._v$=o),i!==r._v$2&&R(l,"y",r._v$2=i),c!==r._v$3&&R(l,"width",r._v$3=c),v!==r._v$4&&R(l,"height",r._v$4=v),y!==r._v$5&&R(l,"fill",r._v$5=y),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),l})()})}const Je=100,Se=20;function Pr(e){const t={cellSize:Je,cellSpacing:Se,gameWidth:e.game.width,gameHeight:e.game.height,toGridSpaceX:n=>(Je+Se)*n+Se,toGridSpaceY:n=>(Je+Se)*(e.game.height-1-n)+Se};return a(Qn,{ctx:t,ref(n){const s=e.ref;typeof s=="function"?s(n):e.ref=n},get children(){return[a(Ar,{ctx:t,get frame(){return e.frame}}),a(Er,{ctx:t,get frame(){return e.frame}}),a(Ir,{ctx:t,get frame(){return e.frame}})]}})}const Hr="_Board_1okyx_1";var Ur={Board:Hr};const jr=m("<div></div>");function Nt(e){const[t,n]=ct(e,["frame","game","ref"]),s=Yt({ref:()=>{}},t);return(()=>{const l=jr.cloneNode(!0);return V(l,n,!1,!0),g(l,a(Pr,s)),J(r=>Oe(l,{[Ur.Board]:!0},r)),l})()}const Fr=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8L4.646 5.354a.5.5 0 0 1 0-.708z"/></g></svg>');var Yr=(e={})=>{const t=Fr.cloneNode(!0);return V(t,e,!0),t};const Gr=m('<div class="absolute inset-0 flex items-center justify-center"><div class="bg-black opacity-25 absolute inset-0"></div><div class="flex flex-col bg-white rounded w-6/12 h-1/4 border shadow z-0"><div class="flex flex-row items-center justify-between py-2 px-4 border-b border-gray-200"><p class="font-semibold text-gray-800"></p></div></div></div>');function qe(e){const[t,n]=e.switch,s=()=>n(!1),l=r=>{r.key=="Escape"&&s()};return document.addEventListener("keydown",l),Gt(()=>{document.removeEventListener("keydown",l)}),a(le,{get when(){return t()},get children(){return a(Vt,{get children(){const r=Gr.cloneNode(!0),o=r.firstChild,i=o.nextSibling,c=i.firstChild,v=c.firstChild;return o.$$click=s,g(v,()=>e.title),g(c,a(Yr,{onclick:s,class:"cursor-pointer"}),null),g(i,()=>e.children,null),r}})}})}ge(["click"]);const Vr=m('<div class="flex flex-col m-4 bg-white shadow"></div>'),Jr=m('<div class="fixed inset-0 h-full w-full z-10"></div>'),qr=m('<div class="absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-md z-20 border border-gray-100"><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">export as curl</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">export as JSON</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-gray-700 hover:bg-yellow-100">edit board</button><button class="block w-full text-left px-4 py-2 text-sm capitalize text-red-700 hover:bg-yellow-100">delete</button></div>'),Wr=m('<div style="border-bottom:1px solid rgba(210,221,234,.5)" class="flex items-center justify-between px-4 py-4"><input type="text" class="border border-opacity-0 border-gray-300 rounded hover:border-opacity-100 cursor-default hover:cursor-text focus-within:cursor-text w-full overflow-ellipsis"><div class="relative"><button class="relative block rounded-md bg-white p-2 ml-1 border border-white hover:border-gray-200 focus:outline-none"></button></div></div>'),Xr=m('<div class="flex items-start flex-wrap p-6"><div class="inline-block"><div class="flex items-center mr-1"><div class="flex-1"><span>Turn:</span><input class="py-0 w-24 text-center focus:ring-0 border-none" type="number"></div><button title="test this turn" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="clone this test" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div></div><table></table></div>'),Kr=m('<div class="p-6"><p class="text-gray-900"><span class="inline-block w-24">Tested:</span><span>Turn </span></p><p><span class="inline-block w-24 text-gray-800">Answered:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><span class="text-red-500"></span></p></div>'),Zr=m('<div class="p-6"><div class="flex items-center text-gray-900"><span class="inline-block w-24">Saved test:</span><span>Turn </span><button title="use current turn for saved test" class="mx-3 text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div><div class="flex items-center"><span class="inline-block w-24 text-gray-800">Expected:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button></div><div class="flex items-center my-2"><span class="inline-block w-24 text-gray-800">Answered:</span><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><button class="bg-gray-200 rounded p-1 text-white mr-2"></button><span class="text-red-500"></span></div><button class="bg-blue-400 text-white mt-2 px-2 font-bold rounded">Run Test</button></div>'),zt=m('<div class="flex-1 p-4"></div>'),Qr=m('<tr><td></td><td class="pr-2 py-1"></td><td class="text-right tabular-nums"></td><td></td><td class="text-right tabular-nums w-10"></td><td></td></tr>'),Mt=m('<textarea readonly class="w-full h-full border-gray-200"></textarea>');function es(e){const t=e.mySnakeStyle,n=e.testResult,[s,l]=G(),[r,o]=G(0),[i,c]=G(),v=k=>()=>(s()||(()=>{throw new Error("!")})())[k],y=(k,p)=>{const $=s()||(()=>{throw new Error("!")})();l({...$,[k]:p})},d=k=>p=>{y(k,p);const $=s()||(()=>{throw new Error("!")})();e.saveTest($)};ve(async()=>{const k=n().id,p=await e.readTest(k),$=s(),N=$?.id==k?r():p.frameToTest;ut(()=>{o(N),l(p),k!=$?.id&&c(void 0)})});const f=fe(()=>{const k=s(),p=k?.frames.find($=>$.turn==r());if(k&&p){const $=p.snakes.map(K=>({...K})),N=$[k.snakeToTest];return N&&Object.assign(N,t()),{...p,snakes:$}}}),u=fe(()=>{const k=s(),p=f();if(k&&p){const $=k.frames,N=$[$.length-1],K=N.snakes.map(B=>B.death?B.death.turn:N.turn+1),Q=p.snakes.map((B,O)=>({...B,idx:O})),L=Jt(Q,K);return dt(B=>-B[1],L).map(B=>B[0])}return[]}),h=k=>{const p=s();if(p){const $=k.target,N=$.value.trim()!=""?+$.value:0,K=p.frames[0].turn,L=p.frames[p.frames.length-1].turn,D=Math.max(K,Math.min(N,L));$.value=$.value.trim()!=""?D.toString():"",o(D)}},[C,_]=G(!1),A=(k,...p)=>()=>{_(!1),k(...p)},[j,z]=G(!1),[ee,F]=G(!1),P=k=>{const p=n();return p.result.type=="passed"&&p.result.move==k},b=k=>{const p=n();return p.result.type=="failed"&&p.result.move==k},x=()=>{const k=n();return k.result.type=="failed"&&!k.result.move?k.result.msg:""},w=k=>()=>{const p=s()||(()=>{throw new Error("!")})(),$=p.expectedResult.includes(k)?p.expectedResult.filter(K=>K!=k):p.expectedResult.concat(k);y("expectedResult",$);const N=s();e.saveTest(N)},E=k=>()=>{y("snakeToTest",k);const p=s()||(()=>{throw new Error("!")})();e.saveTest(p)},M=()=>{y("frameToTest",r());const k=s()||(()=>{throw new Error("!")})();e.saveTest(k)},H=()=>{const k=s()||(()=>{throw new Error("!")})(),p=Ce(k);p.id=xe(10),p.timestamp=Date.now(),p.description="(cloned) "+k.description,p.frameToTest=r(),e.saveTest(p),l(p)},X=async()=>{const k=s()||(()=>{throw new Error("!")})(),p=Ce(k);p.frameToTest=r(),p.expectedResult=["Up","Down","Left","Right"];const $=await e.runUnsavedTest(p);c({turn:p.frameToTest,move:$.move,msg:$.type=="failed"?$.msg:void 0})};return(()=>{const k=Vr.cloneNode(!0);return g(k,a(le,{get when(){return s()},children:p=>[(()=>{const $=Wr.cloneNode(!0),N=$.firstChild,K=N.nextSibling,Q=K.firstChild;return N.$$keydown=L=>{L.key=="Enter"&&L.target.blur()},ye(N,()=>Pe(v("description"),d("description"))),Q.$$click=()=>_(!C()),g(Q,a(ht,{class:"text-gray-500"})),g(K,a(le,{get when(){return C()},get children(){return[(()=>{const L=Jr.cloneNode(!0);return L.$$click=()=>_(!1),L})(),(()=>{const L=qr.cloneNode(!0),D=L.firstChild,B=D.nextSibling,O=B.nextSibling,Y=O.nextSibling;return D.$$click=()=>{z(!0),_(!1)},B.$$click=()=>{F(!0),_(!1)},O.$$click=()=>{e.setView("builder"),_(!1)},he(Y,"click",A(e.deleteTest,p.id),!0),L})()]}}),null),J(()=>N.value=p.description),$})(),(()=>{const $=Xr.cloneNode(!0),N=$.firstChild,K=N.firstChild,Q=K.firstChild,L=Q.firstChild,D=L.nextSibling,B=Q.nextSibling,O=B.nextSibling,Y=N.nextSibling;return g(N,a(le,{get when(){return f()},children:I=>a(Nt,{get game(){return p.game},frame:I})}),K),D.$$input=I=>h(I),B.$$click=X,g(B,a(In,{})),O.$$click=H,g(O,a(Hn,{})),g(Y,a($e,{get each(){return u()},children:I=>{const te=I.death?.3:1;return(()=>{const Z=Qr.cloneNode(!0),de=Z.firstChild,W=de.nextSibling,re=W.nextSibling,ne=re.nextSibling,ue=ne.nextSibling,ke=ue.nextSibling;return g(de,a(jn,{class:"text-gray-300",get classList(){return{"text-blue-400":I.idx==p.snakeToTest}},get onclick(){return E(I.idx)}})),W.style.setProperty("font-size",0),W.style.setProperty("opacity",te),g(W,a(Ne,{get color(){return I.color},get head(){return I.headType},get tail(){return I.tailType}})),re.style.setProperty("opacity",te),g(re,()=>I.body.length),ne.style.setProperty("opacity",te),g(ne,a($t,{class:"text-gray-500"})),ue.style.setProperty("opacity",te),g(ue,()=>I.health),ke.style.setProperty("opacity",te),g(ke,a(bt,{class:"text-red-500"})),Z})()}})),J(()=>D.value=r()),$})(),a(le,{get when(){return i()},get children(){const $=Kr.cloneNode(!0),N=$.firstChild,K=N.firstChild,Q=K.nextSibling;Q.firstChild;const L=N.nextSibling,D=L.firstChild,B=D.nextSibling,O=B.nextSibling,Y=O.nextSibling,I=Y.nextSibling,te=I.nextSibling;return g(Q,()=>i()?.turn,null),g(B,a(Fe,{})),g(O,a(Ye,{})),g(Y,a(Ge,{})),g(I,a(Ve,{})),g(te,()=>i().msg),J(Z=>{const de=i().move=="Up",W=i().move=="Down",re=i().move=="Left",ne=i().move=="Right";return de!==Z._v$&&B.classList.toggle("bg-green-400",Z._v$=de),W!==Z._v$2&&O.classList.toggle("bg-green-400",Z._v$2=W),re!==Z._v$3&&Y.classList.toggle("bg-green-400",Z._v$3=re),ne!==Z._v$4&&I.classList.toggle("bg-green-400",Z._v$4=ne),Z},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),$}}),(()=>{const $=Zr.cloneNode(!0),N=$.firstChild,K=N.firstChild,Q=K.nextSibling;Q.firstChild;const L=Q.nextSibling,D=N.nextSibling,B=D.firstChild,O=B.nextSibling,Y=O.nextSibling,I=Y.nextSibling,te=I.nextSibling,Z=D.nextSibling,de=Z.firstChild,W=de.nextSibling,re=W.nextSibling,ne=re.nextSibling,ue=ne.nextSibling,ke=ue.nextSibling,Ut=Z.nextSibling;return g(Q,()=>p.frameToTest,null),L.$$click=M,g(L,a(Xn,{})),he(O,"click",w("Up"),!0),g(O,a(Fe,{})),he(Y,"click",w("Down"),!0),g(Y,a(Ye,{})),he(I,"click",w("Left"),!0),g(I,a(Ge,{})),he(te,"click",w("Right"),!0),g(te,a(Ve,{})),g(W,a(Fe,{})),g(re,a(Ye,{})),g(ne,a(Ge,{})),g(ue,a(Ve,{})),g(ke,x),Ut.$$click=()=>e.runSingleTest(p.id),J(U=>{const Xe=p.expectedResult.includes("Up"),Ke=p.expectedResult.includes("Down"),Ze=p.expectedResult.includes("Left"),Qe=p.expectedResult.includes("Right"),et=P("Up"),tt=b("Up"),nt=P("Down"),rt=b("Down"),st=P("Left"),lt=b("Left"),ot=P("Right"),it=b("Right");return Xe!==U._v$5&&O.classList.toggle("bg-blue-400",U._v$5=Xe),Ke!==U._v$6&&Y.classList.toggle("bg-blue-400",U._v$6=Ke),Ze!==U._v$7&&I.classList.toggle("bg-blue-400",U._v$7=Ze),Qe!==U._v$8&&te.classList.toggle("bg-blue-400",U._v$8=Qe),et!==U._v$9&&W.classList.toggle("bg-green-400",U._v$9=et),tt!==U._v$10&&W.classList.toggle("bg-red-400",U._v$10=tt),nt!==U._v$11&&re.classList.toggle("bg-green-400",U._v$11=nt),rt!==U._v$12&&re.classList.toggle("bg-red-400",U._v$12=rt),st!==U._v$13&&ne.classList.toggle("bg-green-400",U._v$13=st),lt!==U._v$14&&ne.classList.toggle("bg-red-400",U._v$14=lt),ot!==U._v$15&&ue.classList.toggle("bg-green-400",U._v$15=ot),it!==U._v$16&&ue.classList.toggle("bg-red-400",U._v$16=it),U},{_v$5:void 0,_v$6:void 0,_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0,_v$11:void 0,_v$12:void 0,_v$13:void 0,_v$14:void 0,_v$15:void 0,_v$16:void 0}),$})(),a(qe,{title:"Export as curl",switch:[j,z],get children(){const $=zt.cloneNode(!0);return g($,()=>(()=>{const N=Mt.cloneNode(!0);return g(N,()=>e.asCurl(s())),N})()),$}}),a(qe,{title:"Export as json",switch:[ee,F],get children(){const $=zt.cloneNode(!0);return g($,()=>(()=>{const N=Mt.cloneNode(!0);return g(N,()=>e.asJson(s())),N})()),$}})]})),k})()}ge(["keydown","click","input"]);const ts=m(`<div class="text-center"><p class="text-gray-500">You don't have any tests yet. You can create one by importing a game, or just import some examples to get started.</p><button class="mt-2 bg-blue-400 text-white px-2 font-bold rounded">Import examples</button></div>`),ns=m('<button class="bg-blue-400 text-white px-2 font-bold rounded">Run all tests</button>'),rs=m('<p class="text-red-500"></p>'),ss=m("<ul></ul>"),ls=m('<div class="flex flex-col w-full"><div class="flex flex-0 justify-between mb-4"><p class="font-bold text-gray-500">Tests available:</p></div><div class="overflow-y-auto"></div></div>'),os=m('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#D9D9D9"></circle></svg>'),is=m('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#A7F3D0"></circle><path d="M18 8l-8 8-4-4" stroke="#047857" stroke-width="2"></path></svg>'),as=m('<svg class="flex-shrink-0 inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#FECDD3"></circle><path d="M8 8l8 8M16 8l-8 8" stroke="#B91C1C" stroke-width="2"></path></svg>'),cs=m('<li class="flex items-center px-2 py-2 font-medium leading-5"><span class="truncate"></span></li>');function ds(e){const[t,n]=e.selected,s=e.setView,l=e.testResults,r=qt(t),o=v=>{ut(()=>{n(v),s("test")})},i=v=>{ve(()=>v.querySelectorAll("li")[t()]?.scrollIntoView({block:"nearest"}))},c=()=>(()=>{const v=ts.cloneNode(!0),y=v.firstChild,d=y.nextSibling;return d.$$click=()=>e.importExamples(),v})();return(()=>{const v=ls.cloneNode(!0),y=v.firstChild;y.firstChild;const d=y.nextSibling;g(y,(()=>{const u=Te(()=>e.dbStatus().type=="done",!0);return a(le,{get when(){return u()&&l().length>0},get children(){const h=ns.cloneNode(!0);return he(h,"click",e.runAllTests,!0),h}})})(),null);const f=i;return typeof f=="function"?f(d):i=d,g(d,a(pe,{get children(){return[a(q,{get when(){return e.dbStatus().type=="loading"},children:"loading..."}),a(q,{get when(){return e.dbStatus().type=="error"},get children(){const u=rs.cloneNode(!0);return g(u,()=>{const h=e.dbStatus();return h.type=="error"&&h.message}),u}}),a(q,{get when(){return e.dbStatus().type=="done"},get children(){const u=ss.cloneNode(!0);return g(u,a($e,{get each(){return l()},fallback:c,children:(h,C)=>(()=>{const _=cs.cloneNode(!0),A=_.firstChild;return _.$$click=()=>o(C()),g(_,a(pe,{get children(){return[a(q,{get when(){return h.result.type=="pending"},get children(){return os.cloneNode(!0)}}),a(q,{get when(){return h.result.type==="passed"},get children(){return is.cloneNode(!0)}}),a(q,{get when(){return h.result.type==="failed"},get children(){return as.cloneNode(!0)}})]}}),A),g(A,()=>h.description),J(()=>_.classList.toggle("bg-yellow-100",r(C()))),_})()})),u}})]}})),v})()}ge(["click"]);const us=m(`<div class="flex flex-col m-4 p-6 bg-white max-w-4xl text-gray-700 shadow"><h1 class="py-4 text-2xl text-gray-500 font-semibold">Welcome!</h1><p>This app allow you to import games played in <a target="_blank" class="text-purple-600" href="https://play.battlesnake.com/">https://play.battlesnake.com/</a>, navigate all the turns and create tests for your server. The tests created are saved locally in your browser in a IndexedDB database.</p><h2 class="py-4 text-xl">Get's start</h2><ul><li>1.- config your server on the top left input.</li><li>2.- create a new test importing a game from <a target="_blank" class="text-purple-600" href="https://play.battlesnake.com/">https://play.battlesnake.com/</a>.</li><li>3.- Set the name and expected result.</li></ul><p class="my-2">That's all! You can run a single test or all at once.</p><p class="mt-4">This project is in active development. Visit the <a target="_blank" class="text-purple-600" href="https://github.com/jfgodoy/battlesnake-tester">github repository</a> and leave suggestions of new features.</p></div>`);function gs(){return us.cloneNode(!0)}const hs=m('<div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">DB Exporter</h3><div class="flex my-4"><div class="space-y-2"><div><p>Create a backup of all your tests for example to migrate to another browser, share with friends, or offline processing.</p><button class="bg-blue-400 text-white mt-2 px-2 font-bold rounded">Generate backup</button></div></div></div></div><div class="m-4 p-6 bg-white shadow"><h3 class="text-lg text-gray-700">DB Importer</h3><div class="my-4"><div><div><input type="radio" name="mode" id="add" value="add" checked><label for="add" class="ml-2">Keep existing tests</label></div><div><input type="radio" name="mode" id="replace" value="replace"><label for="replace" class="ml-2">Remove existing tests</label></div></div><div class="mt-2"><label for="files" class="bg-blue-400 text-white text-base mt-2 px-2 py-1 font-bold rounded">Import backup file</label><input id="files" style="visibility:hidden;" type="file" accept="application/json"><p></p></div></div></div></div>');function fs(e){async function t(){const i=await e.exportToJson(),c=JSON.stringify(i,null,2),v=new Blob([c],{type:"application/json;charset=utf-8"});Wt.exports.saveAs(v,"battlesnake-tester-db.json")}const[n,s]=G("add"),[l,r]=G("");async function o(i){r("");const v=i.target.files;if(!v||v.length==0)return;const y=v[0];r("loading...");const d=await new Promise((f,u)=>{const h=new FileReader;h.onload=function(){try{const C=JSON.parse(h.result);f(C)}catch(C){r("file must be json"),u(C)}},h.readAsText(y)});try{const f=T.object.exactShape({version:T.string.equals("1"),tests:T.array.ofType(pt)});T(d,f)}catch(f){r(f.message);return}e.importFromJson(d,{mode:n()}).then(()=>r("file imported!")).catch(f=>r(`Error: ${f.message}`))}return(()=>{const i=hs.cloneNode(!0),c=i.firstChild,v=c.firstChild,y=v.nextSibling,d=y.firstChild,f=d.firstChild,u=f.firstChild,h=u.nextSibling,C=c.nextSibling,_=C.firstChild,A=_.nextSibling,j=A.firstChild,z=j.firstChild,ee=z.firstChild,F=z.nextSibling,P=F.firstChild,b=j.nextSibling,x=b.firstChild,w=x.nextSibling,E=w.nextSibling;return h.$$click=t,ee.$$input=()=>s("add"),P.$$input=()=>s("replace"),w.$$input=o,g(E,l),i})()}ge(["click","input"]);const ms="modulepreload",At={},vs="/battlesnake-tester/",Bt=function(t,n){return!n||n.length===0?t():Promise.all(n.map(s=>{if(s=`${vs}${s}`,s in At)return;At[s]=!0;const l=s.endsWith(".css"),r=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${r}`))return;const o=document.createElement("link");if(o.rel=l?"stylesheet":ms,l||(o.as="script",o.crossOrigin=""),o.href=s,document.head.appendChild(o),l)return new Promise((i,c)=>{o.addEventListener("load",i),o.addEventListener("error",c)})})).then(()=>t())};function ps(){let e=!1;const t="Tests",n=Xt("TestStorage",1,{async upgrade(r,o){r.createObjectStore(t,{keyPath:"id"}),o==0&&(e=!0)}}).then(async r=>{if(e){const o=(await Bt(()=>import("./examples.d6107786.js"),[])).default,i=r.transaction(t,"readwrite").objectStore(t);await Promise.all(o.map(c=>i.put(c)))}return r}),s=[],l=(r,o)=>s.forEach(i=>i(r,o));return{async list(){let o=await(await n).transaction(t).store.openCursor();const i=[];for(;o;)i.push({id:o.value.id,description:o.value.description,timestamp:o.value.timestamp}),o=await o.continue();return dt(c=>c.timestamp,i)},async save(r){const i=(await n).transaction(t,"readwrite").objectStore(t),c=await i.get(r.id);await i.put(r),l(c,r)},async delete(r){const i=(await n).transaction(t,"readwrite").objectStore(t),c=await i.get(r);await i.delete(r),l(c,void 0)},async read(r){return(await n).transaction(t).objectStore(t).get(r)},suscribe(r){s.push(r)},async exportToJson(){let o=await(await n).transaction(t).store.openCursor();const i={version:"1",tests:[]};for(;o;)i.tests.push(o.value),o=await o.continue();return i},async importFromJson(r,o){const c=(await n).transaction(t,"readwrite").objectStore(t);o.mode=="replace"&&c.clear();const v=r.tests.map(y=>c.put(y));await Promise.all(v)}}}function xs(e,t){const n={body:JSON.stringify(t),method:"POST",mode:"cors",headers:[["content-type","application/json"]]};return fetch(e,n).then(s=>s.json()).then(s=>{switch(s.move){case"up":return ze(S.Up);case"down":return ze(S.Down);case"left":return ze(S.Left);case"right":return ze(S.Right);default:return yt("invalid move")}}).catch(s=>(console.log(s),yt("invalid move")))}function Et(e){return{id:e.id,name:e.name,health:e.health,body:e.body,latency:+e.latency,head:e.body[0],length:e.body.length,shout:e.shout,squad:e.squad}}function Dt(e){const t=e.frames.find(o=>o.turn==e.frameToTest);if(!t)return"frame to test not found";const n=t.snakes[e.snakeToTest];if(!n)return"snake to test not found";if(n.death)return"Omae Wa Mou Shindeiru";const s=Et(n),l=t.snakes.filter(o=>!o.death).map(Et);return{board:{food:t.food,snakes:l,width:e.game.width,height:e.game.height,hazards:t.hazards},game:{id:e.game.id,ruleset:e.game.ruleset,timeout:e.game.timeout},turn:t.turn,you:s}}async function We(e,t){const n=Dt(t);if(typeof n=="string")return{type:"failed",msg:n};const s=await xs(e,n),l=t.expectedResult;switch(s.type){case"ok":{const r=S[s.value];return l.indexOf(r)>=0?{type:"passed",move:r}:{type:"failed",move:r,msg:"incorrect move"}}case"error":return{type:"failed",msg:s.msg}}}const ce=ps(),$s={server:"http://localhost:8080",testedSnake:{style:void 0},testResults:[],selected:0,view:"home",dbStatus:{type:"loading"},snakeUrl:void 0},[se,be]=function(){const t=JSON.parse(localStorage.getItem("state")||"{}"),n=Object.assign({},$s,t),[s,l]=gt(n),r=(...o)=>{const i=l.call(null,...o),c=JSON.parse(localStorage.getItem("state")||"{}");return c.server=s.server,c.selected=s.selected,c.view=s.view,c.snakeUrl=s.snakeUrl,localStorage.setItem("state",JSON.stringify(c)),i};return ce.list().then(o=>{const i=o.map(c=>({...c,result:{type:"pending"}}));r("testResults",i),r("dbStatus",{type:"done"})}).catch(o=>{r("dbStatus",{type:"error",message:o.message})}),ce.suscribe((o,i)=>{if(!o&&i){const c={id:i.id,description:i.description,timestamp:i.timestamp,result:{type:"pending"}};r("testResults",v=>[...v,c]),r("selected",s.testResults.length-1)}if(o&&!i){const c=s.testResults.filter(v=>v.id!=o.id);r("testResults",c),r("selected",Math.min(s.testResults.length-1,s.selected))}if(o&&i){const c=()=>{const d=s.testResults.find(h=>h.id==i.id)?.result||{type:"pending"};if(d.type=="pending")return d;const f=d.move;return f?i.expectedResult.includes(f)?{type:"passed",move:f}:{type:"failed",move:f,msg:"incorrect move"}:{type:"failed",msg:d.msg}},v={id:i.id,description:i.description,timestamp:i.timestamp,result:c()},y=s.testResults.map(d=>d.id==i.id?v:d);r("testResults",y)}}),[s,r]}(),Ee=fe(()=>se.testResults[se.selected]);async function bs(e){const t=await ce.read(e),n=await We(`${se.server}/move`,t),s=se.testResults.findIndex(l=>l.id==e);return s>=0&&be("testResults",s,"result",{...{type:void 0,move:void 0,msg:void 0},...n}),n}async function ws(){const e=se.testResults.map(l=>l.id),t=e.map(l=>ce.read(l)).map(l=>l.then(r=>We(`${se.server}/move`,r))),n=await Promise.all(t),s=se.testResults.map(l=>{const r=e.indexOf(l.id);return r>=0?{...l,result:n[r]}:l});be("testResults",s)}function ys(e){return We(`${se.server}/move`,e)}const we=e=>ce.save(e),Ot=e=>ce.read(e),_s=e=>ce.delete(e),Ss=()=>ce.exportToJson(),ks=async(e,t)=>{await ce.importFromJson(e,t),ce.list().then(n=>{const s=n.map(l=>({...l,result:{type:"pending"}}));be("testResults",s),be("dbStatus",{type:"done"})}).catch(n=>{be("dbStatus",{type:"error",message:n.message})})};function me(e){return sn(se,be,e)}const Ts=e=>{const t=Dt(e);return typeof t=="string"?"Error: "+t:`curl -H "Content-type:application/json" --data-raw '${JSON.stringify(t)}' ${se.server}/move`},Cs=e=>JSON.stringify(e),Rs=async()=>{const e={id:xe(10),description:"new test",timestamp:Date.now(),frameToTest:0,snakeToTest:0,expectedResult:[],frames:[{turn:0,snakes:[],food:[],hazards:[]}],game:{id:"new game",timeout:500,width:11,height:11,ruleset:{name:"standard",version:"v.1.2.3"}}};return await we(e),e};function Ls(e){let t=0;if(se.snakeUrl){const s=/\/u\/([^/]+)\/([^/]+)/.exec(se.snakeUrl),l=s?.[1],r=s?.[2];t=e.findIndex(o=>o.author==l&&o.name==r)}const n=se.testedSnake.style;return t<0&&n&&(t=e.findIndex(s=>s.color==n.color&&s.headType==n.headType&&s.tailType==n.tailType)),t>=0?t:0}const It=async(e,t)=>{const n={id:xe(10),description:`test for ${e.id}`,timestamp:Date.now(),game:e,frames:t,frameToTest:0,snakeToTest:Ls(t[0].snakes),expectedResult:[]};return await we(n),n},Ns=async()=>{const e=(await Bt(()=>import("./examples.d6107786.js"),[])).default;await Promise.all(e.map(t=>we(t)))},zs=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 448 512"><path d="M448 240v96c0 3.084-.356 6.159-1.063 9.162l-32 136C410.686 499.23 394.562 512 376 512H168a40.004 40.004 0 0 1-32.35-16.473l-127.997-176c-12.993-17.866-9.043-42.883 8.822-55.876c17.867-12.994 42.884-9.043 55.877 8.823L104 315.992V40c0-22.091 17.908-40 40-40s40 17.909 40 40v200h8v-40c0-22.091 17.908-40 40-40s40 17.909 40 40v40h8v-24c0-22.091 17.908-40 40-40s40 17.909 40 40v24h8c0-22.091 17.908-40 40-40s40 17.909 40 40zm-256 80h-8v96h8v-96zm88 0h-8v96h8v-96zm88 0h-8v96h8v-96z" fill="currentColor"/></svg>');var Ms=(e={})=>{const t=zs.cloneNode(!0);return V(t,e,!0),t};const As=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M19.5 17H18c1.1 0 2-.9 2-2s-.9-2-2-2V9c0-1 0-2-1.08-2.86c.05-.21.08-.42.08-.64C17 3.57 15 2 12.5 2c-2.26 0-4.12 1.31-4.43 3H6L3.71 2.79L3 3.5l2 2l-2 2l.71.71L6 6h2.07c.31 1.69 2.17 3 4.43 3c.5 0 1-.08 1.43-.2c.04.07.07.14.07.2v4H8c-1.1 0-2 .9-2 2s.9 2 2 2H6.5A2.5 2.5 0 0 0 4 19.5c0 .17 0 .34.05.5H4c-1.1 0-2 .9-2 2h17.5a2.5 2.5 0 0 0 0-5M12 5c-.55 0-1-.45-1-1s.45-1 1-1s1 .45 1 1s-.45 1-1 1z" fill="currentColor"/></svg>');var Bs=(e={})=>{const t=As.cloneNode(!0);return V(t,e,!0),t};const Es=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 48 48"><g fill="none"><path d="M20.3 30l-4.216 7.44a.64.64 0 0 0-.059.495a.662.662 0 0 0 .315.393c4.667 2.61 10.654 2.61 15.318 0a.661.661 0 0 0 .317-.393a.638.638 0 0 0-.06-.495L27.701 30a6.046 6.046 0 0 1-3.7 1.25A6.046 6.046 0 0 1 20.3 30z" fill="currentColor"/><path d="M20.85 17.724l-4.336-7.371a.64.64 0 0 0-.398-.299a.662.662 0 0 0-.499.077c-4.593 2.736-7.587 7.92-7.659 13.265a.661.661 0 0 0 .183.471c.12.125.284.195.458.196l8.55.07a6.047 6.047 0 0 1 .769-3.829a6.046 6.046 0 0 1 2.932-2.58z" fill="currentColor"/><path d="M30.85 24.275l8.551-.069a.64.64 0 0 0 .458-.196a.662.662 0 0 0 .183-.47c-.073-5.346-3.066-10.53-7.659-13.265a.662.662 0 0 0-.498-.078a.638.638 0 0 0-.4.299l-4.335 7.37a6.047 6.047 0 0 1 2.932 2.58c.7 1.211.938 2.559.768 3.83z" fill="currentColor"/><path d="M29 24a5 5 0 1 1-10 0a5 5 0 0 1 10 0z" fill="currentColor"/><path fill-rule="evenodd" clip-rule="evenodd" d="M24 42c9.941 0 18-8.059 18-18S33.941 6 24 6S6 14.059 6 24s8.059 18 18 18zm0 2c11.046 0 20-8.954 20-20S35.046 4 24 4S4 12.954 4 24s8.954 20 20 20z" fill="currentColor"/></g></svg>');var Ds=(e={})=>{const t=Es.cloneNode(!0);return V(t,e,!0),t};const Os=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z" fill="currentColor"/></svg>');var Is=(e={})=>{const t=Os.cloneNode(!0);return V(t,e,!0),t};const Ps="_hideSpinner_drfhl_3";var Hs={hideSpinner:Ps};const Us=m("<p>Drag the head or the tail of a snake to change its size.</p>"),js=m("<p>Add a new snake. Choose a style and then drag an empty cell.</p>"),Fs=m("<ul></ul>"),Ys=m("<p>Add hazards in row or column by clicking in a cell next to a wall or another hazards.</p>"),Gs=m("<p>Delete a snakes or food by clicking them</p>"),Vs=m('<div class="flex flex-col m-4 bg-white shadow"><h3 class="text-gray-500 text-xl p-6">Board builder</h3><div class="flex items-start flex-wrap p-6"><div class="inline-block"><div class="flex items-center mr-1"><button title="edit snake" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="new snake" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="add hazards" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button><button title="delete element" class="text-gray-500 p-1 rounded-md border border-white hover:border-gray-200"></button></div></div><table></table></div><div class="p-6"></div><div class="p-6"><button class="bg-blue-400 text-white px-2 font-bold rounded">Save</button></div></div>'),Js=m('<tr><td class="pr-2 py-1"></td><td class="text-right tabular-nums"></td><td></td><td class="text-right tabular-nums w-10"><input class="p-0 w-12 text-right focus:ring-0 border-none" type="number"></td><td></td></tr>'),qs=m('<li class="flex items-center my-2"><input type="radio" name="snakeStyle"><label class="ml-1" style="font-size:0"></label></li>'),Pt=[{head:"default",tail:"default",color:"#2563EB"},{head:"default",tail:"default",color:"#D97706"},{head:"default",tail:"default",color:"#EF4444"},{head:"default",tail:"default",color:"#10B981"}];function Ws(e){const[t,n]=G("pointer"),[s,l]=G(0),[r,o]=G({turn:0,snakes:[],food:[],hazards:[]}),[i,c]=G({id:"builder",timeout:500,width:11,height:11,ruleset:{name:"standard",version:"v.1.2.3"}}),y=e.testResult().id;e.readTest(y).then(b=>{const x=Ce(b.game),w=Ce(b.frames.find(E=>E.turn==b.frameToTest));w.snakes=w.snakes.filter(E=>!E.death),c(x),o(w)});let d={dragging:!1};const f=b=>{const x=+b.dataset.x,w=+b.dataset.y;return{x,y:w}},u=(b,x)=>Math.abs(b.x-x.x)+Math.abs(b.y-x.y),h=b=>r().food.some(x=>oe(x,b)),C=b=>r().snakes.some(x=>x.body.some(w=>oe(w,b))),_=b=>!h(b)&&!C(b),A=b=>r().hazards.some(x=>oe(x,b)),j=b=>b.x<0||b.y<0||b.x>=i().width||b.y>=i().height,z=b=>j(b)||A(b),ee=b=>{b.addEventListener("mousedown",()=>{const x=f(b);if(t()=="add snake"){if(!_(x))return;const M=Pt[s()],H=xe(5),X={id:H,name:"snake "+H,url:"",body:[x],health:100,color:M.color,headType:M.head,tailType:M.tail,latency:"0",shout:"",squad:"",author:"board builder"};o({...r(),snakes:r().snakes.concat([X])}),n("pointer"),d={dragging:!0,snakeIdx:r().snakes.length-1,snakeHandler:"head"};return}if(t()=="hazards"){const M={x:x.x,y:x.y+1},H={x:x.x,y:x.y-1},X={x:x.x-1,y:x.y},k={x:x.x+1,y:x.y};if(A(x)){let p=r().hazards.slice();(!z(M)||!z(H))&&(p=p.filter($=>$.y!=x.y||z({x:$.x,y:$.y+1})&&z({x:$.x,y:$.y-1}))),(!z(X)||!z(k))&&(p=p.filter($=>$.x!=x.x||z({x:$.x-1,y:$.y})&&z({x:$.x+1,y:$.y}))),p.length===i().height*i().width&&(p=p.filter($=>!oe($,x))),o({...r(),hazards:p})}else{const p=r().hazards.slice();if(z(M)||z(H))for(let $=0,N=i().width;$<N;$++)p.push({x:$,y:x.y});if(z(X)||z(k))for(let $=0,N=i().height;$<N;$++)p.push({x:x.x,y:$});o({...r(),hazards:Zt(p)})}return}if(t()=="delete"){if(h(x)){o({...r(),food:r().food.filter(H=>!oe(H,x))});return}const M=r().snakes.findIndex(H=>H.body.find(X=>oe(X,x)));M>=0&&o({...r(),snakes:[...r().snakes.slice(0,M),...r().snakes.slice(M+1)]});return}if(_(x)){o({...r(),food:[...r().food,x]});return}if(h(x)){o({...r(),food:r().food.filter(M=>!oe(M,x))});return}const w=r().snakes.findIndex(M=>oe(M.body[0],x));if(w>=0){d={dragging:!0,snakeIdx:w,snakeHandler:"head"};return}const E=r().snakes.findIndex(M=>oe(M.body[M.body.length-1],x));E>=0&&(d={dragging:!0,snakeIdx:E,snakeHandler:"tail"})}),b.addEventListener("mouseenter",()=>{if(d.dragging){const x=f(b),w={...r().snakes[d.snakeIdx]};w.body=w.body.slice(),d.snakeHandler=="tail"&&w.body.reverse();const E=w.body[0];if(u(E,x)==1){w.body[1]&&oe(x,w.body[1])?w.body.length>=2&&w.body.shift():_(x)&&w.body.unshift(x),d.snakeHandler=="tail"&&w.body.reverse();const M=r().snakes.slice();M[d.snakeIdx]=w,o({...r(),snakes:M})}else if(u(E,x)==2&&E.x!=x.x&&E.y!=x.y){if(w.body[2]&&oe(x,w.body[2]))w.body.length>=3&&(w.body.shift(),w.body.shift());else{const H={x:E.x,y:x.y},X={x:x.x,y:E.y};_(H)&&_(x)?(w.body.unshift(H),w.body.unshift(x)):_(X)&&_(x)&&(w.body.unshift(X),w.body.unshift(x))}d.snakeHandler=="tail"&&w.body.reverse();const M=r().snakes.slice();M[d.snakeIdx]=w,o({...r(),snakes:M})}}}),window.addEventListener("mouseup",()=>{d.dragging=!1})},F=(b,x)=>{const w=b.target,E=w.value.trim()!=""?+w.value:0,M=Math.min(Math.max(0,E),100);w.value=w.value.trim()!=""?M.toString():"";const H=r().snakes.slice();H[x]={...H[x],health:M},o({...r(),snakes:H})};async function P(){const b=await e.readTest(y),x=b.frames.length>1,w={id:x?xe(10):b.id,timestamp:Date.now(),description:x?"(truncated) "+b.description:b.description,game:i(),frames:[r()],frameToTest:r().turn,snakeToTest:b.snakeToTest<=r().snakes.length-1?b.snakeToTest:0,expectedResult:b.expectedResult};await e.saveTest(w),e.setView("test")}return(()=>{const b=Vs.cloneNode(!0),x=b.firstChild,w=x.nextSibling,E=w.firstChild,M=E.firstChild,H=M.firstChild,X=H.nextSibling,k=X.nextSibling,p=k.nextSibling,$=E.nextSibling,N=w.nextSibling,K=N.nextSibling,Q=K.firstChild;return g(E,a(Nt,{get frame(){return r()},get game(){return i()},ref(L){const D=ee;typeof D=="function"?D(L):ee=L},class:"cursor-pointer"}),M),H.$$click=()=>n("pointer"),g(H,a(Ms,{})),X.$$click=()=>n("add snake"),g(X,a(Bs,{})),k.$$click=()=>n("hazards"),g(k,a(Ds,{})),p.$$click=()=>n("delete"),g(p,a(Is,{})),g($,a(Kt,{get each(){return r().snakes},children:(L,D)=>(()=>{const B=Js.cloneNode(!0),O=B.firstChild,Y=O.nextSibling,I=Y.nextSibling,te=I.nextSibling,Z=te.firstChild,de=te.nextSibling;return O.style.setProperty("font-size",0),g(O,a(Ne,{get color(){return L().color},get head(){return L().headType},get tail(){return L().tailType}})),g(Y,()=>L().body.length),g(I,a($t,{class:"text-gray-500"})),Z.$$input=W=>F(W,D),g(de,a(bt,{class:"text-red-500"})),J(W=>{const re={[Hs.hideSpinner]:!0},ne=L().health;return W._v$5=Oe(Z,re,W._v$5),ne!==W._v$6&&(Z.value=W._v$6=ne),W},{_v$5:void 0,_v$6:void 0}),B})()})),g(N,a(pe,{get children(){return[a(q,{get when(){return t()=="pointer"},get children(){return Us.cloneNode(!0)}}),a(q,{get when(){return t()=="add snake"},get children(){return[js.cloneNode(!0),(()=>{const L=Fs.cloneNode(!0);return g(L,a($e,{each:Pt,children:(D,B)=>(()=>{const O=qs.cloneNode(!0),Y=O.firstChild,I=Y.nextSibling;return Y.$$input=()=>l(B()),g(I,a(Ne,{get head(){return D.head},get tail(){return D.tail},get color(){return D.color}})),J(()=>Y.checked=B()==0),O})()})),L})()]}}),a(q,{get when(){return t()=="hazards"},get children(){return Ys.cloneNode(!0)}}),a(q,{get when(){return t()=="delete"},get children(){return Gs.cloneNode(!0)}})]}})),Q.$$click=()=>P(),J(L=>{const D=t()=="pointer",B=t()=="add snake",O=t()=="hazards",Y=t()=="delete";return D!==L._v$&&H.classList.toggle("border-gray-300",L._v$=D),B!==L._v$2&&X.classList.toggle("border-gray-300",L._v$2=B),O!==L._v$3&&k.classList.toggle("border-gray-300",L._v$3=O),Y!==L._v$4&&p.classList.toggle("border-gray-300",L._v$4=Y),L},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),b})()}ge(["click","input"]);const Xs=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 256"><path d="M237.458 104.267a8 8 0 0 0-3.935-5.298l-23.776-13.198a92.528 92.528 0 0 0-4.3-7.461l.458-27.213a8 8 0 0 0-2.622-6.058a111.134 111.134 0 0 0-41.11-23.697a8 8 0 0 0-6.554.76L132.3 36.091a92.092 92.092 0 0 0-8.611-.006l-23.337-14.003a8.004 8.004 0 0 0-6.558-.76a111.15 111.15 0 0 0-41.077 23.754a8 8 0 0 0-2.62 6.057l.458 27.19a92.436 92.436 0 0 0-4.312 7.454l-23.796 13.21a8.002 8.002 0 0 0-3.935 5.3a111.14 111.14 0 0 0 .032 47.45a8 8 0 0 0 3.935 5.297l23.776 13.198a92.593 92.593 0 0 0 4.3 7.461l-.458 27.213a8 8 0 0 0 2.622 6.058a111.134 111.134 0 0 0 41.11 23.697a8.003 8.003 0 0 0 6.554-.76l23.319-13.99c2.867.135 5.748.138 8.611.006l23.337 14.003a8.002 8.002 0 0 0 6.558.76a111.156 111.156 0 0 0 41.077-23.754a8.002 8.002 0 0 0 2.62-6.057l-.458-27.19a92.426 92.426 0 0 0 4.312-7.454l23.796-13.21a8.002 8.002 0 0 0 3.935-5.3a111.133 111.133 0 0 0-.032-47.45zm-14.913 40.56l-22.717 12.611a8.003 8.003 0 0 0-3.323 3.52a76.198 76.198 0 0 1-5.704 9.862a8 8 0 0 0-1.393 4.648l.437 25.965a95.045 95.045 0 0 1-29.143 16.86l-22.28-13.369a7.998 7.998 0 0 0-4.116-1.14q-.297 0-.596.022a76.078 76.078 0 0 1-11.39-.009a8.016 8.016 0 0 0-4.722 1.118l-22.268 13.36a95.056 95.056 0 0 1-29.173-16.808l.438-25.979a8.002 8.002 0 0 0-1.387-4.638a76.166 76.166 0 0 1-5.688-9.87a8.002 8.002 0 0 0-3.33-3.531l-22.704-12.604a95.032 95.032 0 0 1-.029-33.669l22.717-12.61a8.003 8.003 0 0 0 3.323-3.521a76.198 76.198 0 0 1 5.704-9.86a8 8 0 0 0 1.393-4.649l-.437-25.965A95.05 95.05 0 0 1 95.3 37.711l22.28 13.369a8.023 8.023 0 0 0 4.712 1.118a76.014 76.014 0 0 1 11.39.009a7.997 7.997 0 0 0 4.722-1.118l22.268-13.361a95.05 95.05 0 0 1 29.173 16.81l-.438 25.978a8.003 8.003 0 0 0 1.387 4.638a76.148 76.148 0 0 1 5.688 9.87a8.002 8.002 0 0 0 3.329 3.531l22.705 12.604a95.032 95.032 0 0 1 .029 33.669zM128 72.003a56 56 0 1 0 56 56a56.064 56.064 0 0 0-56-56zm0 96a40 40 0 1 1 40-40a40.045 40.045 0 0 1-40 40z" fill="currentColor"/></svg>');var Ks=(e={})=>{const t=Xs.cloneNode(!0);return V(t,e,!0),t};const Zs=m('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1.2em" height="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><path d="M6.359 7.808l1.594-.488a1 1 0 0 1 .585 1.913l-3.825 1.17a1 1 0 0 1-1.249-.665l-1.17-3.825a1 1 0 1 1 1.913-.585l.44 1.441c2.408-3.709 7.185-5.304 11.426-3.566a9.381 9.381 0 0 1 5.38 5.831a1 1 0 1 1-1.905.608A7.381 7.381 0 0 0 6.36 7.808zm12.327 8.195l-1.775.443a1 1 0 1 1-.484-1.94l3.643-.909a.997.997 0 0 1 .61-.08a1 1 0 0 1 .84.75l.968 3.88a1 1 0 0 1-1.94.484l-.33-1.322a9.381 9.381 0 0 1-16.384-1.796l-.26-.634a1 1 0 1 1 1.851-.758l.26.633a7.381 7.381 0 0 0 13.001 1.25z" fill="currentColor"/></svg>');var Qs=(e={})=>{const t=Zs.cloneNode(!0);return V(t,e,!0),t};const el=m('<div class="flex-1 p-4"><p class="text-gray-700">Set your snake url:</p><input type="text" class="w-7/12 min-w-96 p-0 px-3 rounded text-gray-700 border-gray-300"><button class="ml-2 bg-blue-400 text-white px-2 font-bold rounded">Save</button><p class="text-red-500"></p><p class="text-xs text-gray-600">It should have this format https://play.battlesnake.com/u/&lt;username&gt;/&lt;snake-name&gt;/</p></div>'),tl=m('<button class="text-gray-500 px-2 font-bold rounded"></button>'),nl=m('<button class="text-gray-500 px-2 mr-2 font-bold rounded"></button>'),rl=m('<p class="text-gray-700 px-4">loading...</p>'),sl=m('<div class="px-4"><p class="text-gray-700">Configure your snake url to fetch its recent games and easily import them.</p><p class="text-center my-4"><button class="bg-blue-400 text-white px-2 font-bold rounded">Configure</button></p></div>'),ll=m('<div class="mx-4"><h3 class="text-red-500">Whops!</h3><p class="text-red-500"></p><p class="mt-4 text-gray-700 break-words">Check if you can reach the configured snake url: <a target="_blank"></a></p></div>'),ol=m('<div class="flex-1 space-y-2 divide-y divide-gray-200 text-gray-600"></div>'),il=m('<div class="flex flex-col w-full"><div class="flex flex-0 mb-4"><p class="flex-1 font-bold text-gray-500 px-4 py-4">Recent games</p></div><div class="overflow-y-auto"></div></div>'),al=m('<div class="px-4"><p class="flex pt-3 items-baseline"><span class="flex-1"></span> <span class="text-sm"></span></p><p></p><p><button class="border border-gray-300 rounded px-2 text-xs hover:bg-blue-400 hover:text-white hover:border-blue-500 text-gray-500">import</button><span class="ml-2"></span></p></div>');function cl(e){const[t,n]=G("");let s=e.snakeUrl();function l(){if(typeof s=="string"){if(s=s.trim(),s=="")s=void 0;else if(!/^https:\/\/play.battlesnake.com\/u\/[^/]+\/[^/]+\/?$/.test(s)){n("invalid format");return}}e.setSnakeUrl(s),e.setShowConfig(!1)}return a(qe,{title:"Config Recent Games",get switch(){return[e.showConfig,e.setShowConfig]},get children(){const r=el.cloneNode(!0),o=r.firstChild,i=o.nextSibling,c=i.nextSibling,v=c.nextSibling;return ye(i,()=>Pe(e.snakeUrl,y=>{s=y})),i.$$input=()=>n(""),c.$$click=l,g(v,t),r}})}function dl(e){const[t,n]=G(!1),[s,l]=G(""),[r,o]=gt({games:[]}),[i,c]=G(!1),v=async d=>{const f=C=>o("games",d,"importState",C);f("importing...");const u=r.games[d].gameId,h=await vt(u).catch(C=>{throw f(C),C});e.createTest(h.game,h.frames),e.setView("test"),f("done!"),setTimeout(()=>f(""),1e3)};async function y(){l("");const d=e.snakeUrl();if(!d){console.log(new Error("missing snake url"));return}c(!0);const f="http://143.198.73.242:4000/recent-games/"+d.replace("https://play.battlesnake.com/",""),u=await fetch(f);if(!u.ok){l(u.statusText),o("games",[]),c(!1);return}const h=await u.json();o("games",h),c(!1)}return ve(()=>y()),(()=>{const d=il.cloneNode(!0),f=d.firstChild;f.firstChild;const u=f.nextSibling;return g(f,a(le,{get when(){return e.snakeUrl()},get children(){return[(()=>{const h=tl.cloneNode(!0);return h.$$click=()=>n(!0),g(h,a(Ks,{})),h})(),(()=>{const h=nl.cloneNode(!0);return h.$$click=y,g(h,a(Qs,{})),h})()]}}),null),g(u,a(le,{get when(){return i()},get children(){return rl.cloneNode(!0)}}),null),g(u,a(pe,{get children(){return[a(q,{get when(){return!e.snakeUrl()},get children(){const h=sl.cloneNode(!0),C=h.firstChild,_=C.nextSibling,A=_.firstChild;return A.$$click=()=>n(!0),h}}),a(q,{get when(){return s()},get children(){const h=ll.cloneNode(!0),C=h.firstChild,_=C.nextSibling,A=_.nextSibling,j=A.firstChild,z=j.nextSibling;return g(_,s),g(z,()=>e.snakeUrl()),J(()=>R(z,"href",e.snakeUrl())),h}}),a(q,{get when(){return e.snakeUrl()},get children(){const h=ol.cloneNode(!0);return g(h,a($e,{get each(){return r.games},children:(C,_)=>(()=>{const A=al.cloneNode(!0),j=A.firstChild,z=j.firstChild,ee=z.nextSibling,F=ee.nextSibling,P=j.nextSibling,b=P.nextSibling,x=b.firstChild,w=x.nextSibling;return g(z,()=>C.arena),g(F,()=>C.date),g(P,()=>C.board),x.$$click=()=>v(_()),g(w,()=>C.importState),A})()})),h}})]}}),null),g(d,a(cl,{showConfig:t,setShowConfig:n,get snakeUrl(){return e.snakeUrl},get setSnakeUrl(){return e.setSnakeUrl}}),null),d})()}ge(["input","click"]);const ul=m('<div class="flex flex-col h-screen min-w-max"><header><div class="p-4" style="background-color:#72268c;"><h1 class="text-center text-white text-2xl font-semibold tracking-wide">Battlesnake Tester</h1></div><div class="p-4 bg-white" style="box-shadow:0 1px 1px 1px rgb(18 106 211 / 8%);"></div></header><div class="flex flex-1 flex-row mt-1 overflow-hidden"><aside class="flex bg-white w-80 p-4 shadow"></aside><main class="flex flex-1 flex-col p-4 overflow-y-auto"><div class="flex"></div><div class="flex flex-1 items-end"><a class="m-4 text-gray-500 hover:text-blue-400 text-sm" target="_blank" href="https://play.battlesnake.com/">Assets used with permission from Battlesnake</a></div></main><aside class="flex bg-white w-80 shadow"></aside></div></div>'),gl=()=>{const[e,t]=me("server"),[n,s]=me("view"),[l,r]=me("testResults"),[o,i]=me("testedSnake.style"),[c]=me("dbStatus"),[v,y]=me("snakeUrl"),d=me("selected"),[f,u]=G(!0),h=_=>{s(_),u(!f())};function C(_){return fe(Qt(_.on,()=>_.children))}return(()=>{const _=ul.cloneNode(!0),A=_.firstChild,j=A.firstChild,z=j.firstChild,ee=j.nextSibling,F=A.nextSibling,P=F.firstChild,b=P.nextSibling,x=b.firstChild,w=b.nextSibling;return z.$$click=()=>h("home"),g(ee,a(yn,{server:[e,t],style:[o,i],setView:h,get createEmptyTest(){return Rs}})),g(P,a(ds,{get runAllTests(){return ws},selected:d,setView:h,testResults:l,get importExamples(){return Ns},dbStatus:c})),g(x,a(pe,{get children(){return[a(q,{get when(){return n()=="home"},get children(){return a(gs,{})}}),(()=>{const E=Te(()=>n()=="test",!0);return a(q,{get when(){return E()&&Ee()},get children(){return a(es,{mySnakeStyle:o,get testResult(){return Ee},get runSingleTest(){return bs},get runUnsavedTest(){return ys},get readTest(){return Ot},get deleteTest(){return _s},get saveTest(){return we},get asCurl(){return Ts},get asJson(){return Cs},setView:h})}})})(),a(q,{get when(){return n()=="importer"},get children(){return a(C,{on:f,get children(){return a(Dn,{server:e,get createTest(){return It},get saveTest(){return we},setView:h})}})}}),a(q,{get when(){return n()=="exportimportdb"},get children(){return a(fs,{get exportToJson(){return Ss},get importFromJson(){return ks}})}}),(()=>{const E=Te(()=>n()=="builder",!0);return a(q,{get when(){return E()&&Ee()},get children(){return a(C,{on:f,get children(){return a(Ws,{get testResult(){return Ee},get readTest(){return Ot},get saveTest(){return we},setView:h})}})}})})()]}})),g(w,a(dl,{get createTest(){return It},setView:h,snakeUrl:v,setSnakeUrl:y})),_})()};ge(["click"]);const Ht=document.getElementById("root");Ht&&en(()=>a(gl,{}),Ht);
